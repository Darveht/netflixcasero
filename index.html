<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
  <meta name="screen-orientation" content="portrait">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000">
  <title>IBTV</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  <style>
    /* Reinicio básico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #000000;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      overscroll-behavior: contain;
      color: #ffffff;
      position: relative;
    }

    /* Header estilo Twitter */
    .header {
      width: 100%;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(12px);
      border-bottom: 0.5px solid #333639;
      position: sticky;
      top: 0;
      z-index: 900;
    }

    .search-container {
      position: relative;
      max-width: 500px;
      margin: 0 auto;
    }

    .search-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      background: #202327;
      border-radius: 50px;
      border: 1px solid #333639;
      transition: all 0.2s ease;
    }

    .search-wrapper:focus-within {
      background: #000000;
      border-color: #1d9bf0;
      box-shadow: 0 0 0 1px #1d9bf0;
    }

    .search-icon {
      padding: 0 16px;
      color: #71767b;
      font-size: 18px;
    }

    .search-wrapper:focus-within .search-icon {
      color: #1d9bf0;
    }

    .header input {
      flex: 1;
      padding: 12px 0;
      border: none;
      background: transparent;
      color: #ffffff;
      font-size: 15px;
      outline: none;
      border-radius: 50px;
    }

    .header input::placeholder {
      color: #71767b;
    }

    .search-btn {
      background: transparent;
      border: none;
      color: #71767b;
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 50px;
      transition: all 0.2s ease;
    }

    .search-btn:hover {
      background: rgba(29, 155, 240, 0.1);
      color: #1d9bf0;
    }

    /* Contenedor principal estilo Netflix */
    .app-container {
      min-height: calc(100vh - 80px);
      width: 100%;
      background: #000000;
      padding-bottom: 80px;
    }

    /* Banner principal estilo Netflix */
    .hero-banner {
      position: relative;
      height: 60vh;
      background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=1920') center/cover;
      display: flex;
      align-items: flex-end;
      padding: 40px 16px;
    }

    .hero-content {
      max-width: 500px;
    }

    .hero-title {
      font-size: 48px;
      font-weight: 800;
      margin-bottom: 16px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }

    .hero-description {
      font-size: 18px;
      line-height: 1.4;
      margin-bottom: 24px;
      color: #e7e9ea;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }

    .hero-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .hero-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 50px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hero-btn.primary {
      background: #1d9bf0;
      color: #ffffff;
    }

    .hero-btn.primary:hover {
      background: #1a8cd8;
      transform: translateY(-1px);
    }

    .hero-btn.secondary {
      background: rgba(255,255,255,0.2);
      color: #ffffff;
      backdrop-filter: blur(12px);
    }

    .hero-btn.secondary:hover {
      background: rgba(255,255,255,0.3);
    }

    /* Secciones de carruseles */
    .content-sections {
      padding: 40px 0;
    }

    .section {
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 16px;
      padding: 0 16px;
      color: #ffffff;
    }

    .carousel-container {
      position: relative;
      overflow: hidden;
    }

    .carousel {
      display: flex;
      gap: 12px;
      padding: 0 16px;
      overflow-x: auto;
      scroll-behavior: smooth;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .carousel::-webkit-scrollbar {
      display: none;
    }

    .carousel-item {
      flex-shrink: 0;
      width: 280px;
      height: 160px;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      background: #202327;
    }

    .carousel-item:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 32px rgba(29, 155, 240, 0.3);
    }

    .carousel-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .carousel-item-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      padding: 16px;
      color: #ffffff;
    }

    .carousel-item-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .carousel-item-info {
      font-size: 12px;
      color: #71767b;
    }

    /* Etiqueta animada para películas */
    .movie-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: linear-gradient(45deg, #ff6b6b, #ff8e53);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      animation: moviePulse 2s ease-in-out infinite;
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
      z-index: 10;
    }

    /* Etiqueta de estreno */
    .premiere-badge {
      position: absolute;
      top: 8px;
      left: 8px;
      background: linear-gradient(45deg, #1d9bf0, #00c9ff);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      animation: premierePulse 2s ease-in-out infinite;
      box-shadow: 0 2px 8px rgba(29, 155, 240, 0.4);
      z-index: 10;
    }

    /* Etiqueta de en vivo */
    .live-badge {
      position: absolute;
      top: 8px;
      left: 8px;
      background: linear-gradient(45deg, #ff0000, #ff4444);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      animation: livePulse 1s ease-in-out infinite;
      box-shadow: 0 2px 8px rgba(255, 0, 0, 0.6);
      z-index: 10;
    }

    /* Overlay de bloqueo mejorado estilo Netflix */
    .locked-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(20, 20, 20, 0.95));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      border-radius: 12px;
      z-index: 15;
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    .locked-icon {
      font-size: 40px;
      margin-bottom: 12px;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      animation: lockPulse 2s ease-in-out infinite;
    }

    .locked-text {
      font-size: 14px;
      text-align: center;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    .release-date {
      font-size: 11px;
      color: #71767b;
      margin-top: 4px;
      font-weight: 600;
    }

    @keyframes lockPulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.8;
      }
      50% {
        transform: scale(1.1);
        opacity: 1;
      }
    }

    /* Cuenta regresiva moderna */
    .countdown-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(29, 155, 240, 0.9), rgba(13, 110, 253, 0.9));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      border-radius: 12px;
      z-index: 20;
      backdrop-filter: blur(10px);
    }

    .countdown-title {
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      text-align: center;
    }

    .countdown-timer {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .countdown-segment {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 8px 6px;
      min-width: 35px;
      text-align: center;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .countdown-number {
      font-size: 18px;
      font-weight: 800;
      line-height: 1;
      display: block;
    }

    .countdown-label {
      font-size: 8px;
      text-transform: uppercase;
      opacity: 0.8;
      font-weight: 600;
      margin-top: 2px;
    }

    .countdown-premiere-time {
      font-size: 11px;
      opacity: 0.9;
      text-align: center;
      font-weight: 600;
    }

    /* Animación de pulso para cuenta regresiva */
    @keyframes countdownPulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 20px rgba(29, 155, 240, 0.4);
      }
      50% {
        transform: scale(1.02);
        box-shadow: 0 0 30px rgba(29, 155, 240, 0.6);
      }
    }

    .countdown-overlay {
      animation: countdownPulse 3s ease-in-out infinite;
    }

    /* Animación de estreno en vivo */
    .premiere-live-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.9), rgba(255, 69, 0, 0.9));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      border-radius: 12px;
      z-index: 25;
      animation: liveGlow 2s ease-in-out infinite;
    }

    .live-title {
      font-size: 16px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 8px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
    }

    .live-subtitle {
      font-size: 12px;
      font-weight: 600;
      opacity: 0.9;
    }

    @keyframes liveGlow {
      0%, 100% {
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 40px rgba(255, 0, 0, 0.8);
        transform: scale(1.02);
      }
    }

    @keyframes moviePulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 4px 16px rgba(255, 107, 107, 0.6);
      }
    }

    @keyframes premierePulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 2px 8px rgba(29, 155, 240, 0.4);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 4px 16px rgba(29, 155, 240, 0.6);
      }
    }

    @keyframes livePulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 2px 8px rgba(255, 0, 0, 0.6);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(255, 0, 0, 0.8);
      }
    }

    /* Vista expandida de serie estilo Netflix */
    .series-detail {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #000000;
      z-index: 3000;
      display: none;
      overflow-y: auto;
    }

    .series-detail.active {
      display: block;
    }

    .series-detail-header {
      position: relative;
      height: 70vh;
      overflow: hidden;
      display: flex;
      align-items: flex-end;
      padding: 40px 16px;
    }

    /* Video de fondo para el trailer */
    .series-detail-video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      z-index: 1;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      filter: none;
    }

    .series-detail-video.loaded {
      opacity: 1;
      filter: none;
    }

    /* Overlay gradiente mejorado */
    .series-detail-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        to bottom,
        rgba(0,0,0,0.2) 0%,
        rgba(0,0,0,0.4) 50%,
        rgba(0,0,0,0.8) 80%,
        rgba(0,0,0,0.95) 100%
      );
      z-index: 2;
    }

    /* Imagen de fondo de respaldo */
    .series-detail-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: 0;
      filter: blur(1px);
    }

    .series-close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.75);
      border: none;
      color: #ffffff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(12px);
      z-index: 10;
    }

    .series-close-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.1);
    }

    /* Botón de play circular estilo Netflix */
    .netflix-play-btn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.95);
      border: 3px solid rgba(255, 255, 255, 0.5);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      transition: all 0.3s ease;
      backdrop-filter: blur(12px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .netflix-play-btn:hover {
      transform: translate(-50%, -50%) scale(1.1);
      background: rgba(255, 255, 255, 1);
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
      border-color: rgba(255, 255, 255, 0.8);
    }

    .netflix-play-btn i {
      font-size: 28px;
      color: #000000;
      margin-left: 4px;
    }

    /* Loading spinner mejorado para el botón */
    .netflix-play-btn.loading {
      background: rgba(255, 255, 255, 0.95);
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #1d9bf0;
      animation: netflixSpin 1s linear infinite;
    }

    .netflix-play-btn.loading i {
      display: none;
    }

    .netflix-play-btn.loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top: 2px solid #1d9bf0;
      border-radius: 50%;
      animation: innerSpin 0.8s linear infinite;
    }

    @keyframes netflixSpin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    @keyframes innerSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Indicador de sonido */
    .sound-indicator {
      position: absolute;
      bottom: 100px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 5;
      transition: all 0.2s ease;
      backdrop-filter: blur(12px);
    }

    .sound-indicator:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .sound-indicator i {
      color: #ffffff;
      font-size: 16px;
    }

    .series-detail-content {
      max-width: 500px;
      position: relative;
      z-index: 3;
    }

    .series-detail-title {
      font-size: 48px;
      font-weight: 800;
      margin-bottom: 16px;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
      color: #ffffff;
    }

    .series-detail-meta {
      display: flex;
      gap: 16px;
      margin-bottom: 20px;
      font-size: 16px;
      color: #e7e9ea;
      font-weight: 600;
    }

    .series-detail-meta span {
      background: rgba(0, 0, 0, 0.6);
      padding: 4px 12px;
      border-radius: 20px;
      backdrop-filter: blur(8px);
    }

    .series-detail-description {
      font-size: 18px;
      line-height: 1.6;
      color: #ffffff;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.8);
      background: rgba(0, 0, 0, 0.4);
      padding: 20px;
      border-radius: 12px;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .series-actions {
      padding: 40px 16px 24px 16px;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      background: linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(0,0,0,1));
    }

    /* Sistema de calificaciones estilo Twitter */
    .rating-section {
      padding: 20px 16px;
      border-top: 1px solid #333639;
      border-bottom: 1px solid #333639;
      margin: 20px 0;
    }

    .rating-title {
      font-size: 16px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .rating-title i {
      color: #1d9bf0;
    }

    .rating-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .rating-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      border: none;
      border-radius: 50px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 120px;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .rating-btn:before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.5s;
    }

    .rating-btn:hover:before {
      left: 100%;
    }

    .rating-btn.good {
      background: linear-gradient(45deg, #10b981, #34d399);
      color: #ffffff;
      border: 2px solid transparent;
    }

    .rating-btn.good:hover {
      background: linear-gradient(45deg, #059669, #10b981);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }

    .rating-btn.good.active {
      background: linear-gradient(45deg, #059669, #10b981);
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
      transform: scale(1.05);
    }

    .rating-btn.bad {
      background: linear-gradient(45deg, #ef4444, #f87171);
      color: #ffffff;
      border: 2px solid transparent;
    }

    .rating-btn.bad:hover {
      background: linear-gradient(45deg, #dc2626, #ef4444);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }

    .rating-btn.bad.active {
      background: linear-gradient(45deg, #dc2626, #ef4444);
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
      transform: scale(1.05);
    }

    .rating-count {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 2px 8px;
      font-size: 12px;
      font-weight: 700;
      min-width: 20px;
      text-align: center;
    }

    .rating-stats {
      margin-top: 16px;
      padding: 12px 16px;
      background: rgba(32, 35, 39, 0.5);
      border-radius: 12px;
      border: 1px solid #333639;
    }

    .rating-stats-title {
      font-size: 12px;
      color: #71767b;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .rating-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .rating-bar:last-child {
      margin-bottom: 0;
    }

    .rating-label {
      font-size: 13px;
      color: #ffffff;
      font-weight: 600;
      min-width: 50px;
    }

    .rating-progress {
      flex: 1;
      height: 8px;
      background: #202327;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .rating-progress-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.8s ease;
      position: relative;
    }

    .rating-progress-fill.good {
      background: linear-gradient(90deg, #10b981, #34d399);
    }

    .rating-progress-fill.bad {
      background: linear-gradient(90deg, #ef4444, #f87171);
    }

    .rating-progress-fill:after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% {
        left: -100%;
      }
      100% {
        left: 100%;
      }
    }

    .rating-percentage {
      font-size: 12px;
      color: #71767b;
      font-weight: 600;
      min-width: 35px;
      text-align: right;
    }

    /* Animación de feedback */
    .rating-feedback {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(29, 155, 240, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      z-index: 1000;
      pointer-events: none;
      opacity: 0;
      animation: feedbackPop 2s ease-out;
    }

    @keyframes feedbackPop {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
      20% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
      }
      80% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
      }
    }

    .series-btn {
      padding: 16px 32px;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 160px;
      justify-content: center;
    }

    .series-btn.primary {
      background: linear-gradient(45deg, #ffffff, #f0f0f0);
      color: #000000;
      box-shadow: 0 4px 16px rgba(255, 255, 255, 0.2);
    }

    .series-btn.primary:hover {
      background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 255, 255, 0.3);
    }

    .series-btn.secondary {
      background: rgba(109, 109, 110, 0.7);
      color: #ffffff;
      border: 2px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(12px);
    }

    .series-btn.secondary:hover {
      background: rgba(109, 109, 110, 0.9);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
    }

    .series-btn i {
      font-size: 20px;
    }

    /* Lista de episodios */
    .episodes-section {
      padding: 0 16px 40px 16px;
    }

    .episodes-title {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 20px;
      color: #ffffff;
    }

    .episode-item {
      display: flex;
      gap: 16px;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 12px;
      background: #202327;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid #333639;
    }

    .episode-item:hover {
      background: #333639;
      border-color: #1d9bf0;
      transform: translateY(-1px);
    }

    .episode-thumbnail {
      width: 120px;
      height: 68px;
      border-radius: 8px;
      overflow: hidden;
      flex-shrink: 0;
      background: #71767b;
      position: relative;
    }

    .episode-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .episode-play-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(29, 155, 240, 0.9);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-size: 12px;
    }

    .episode-info {
      flex: 1;
    }

    .episode-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .episode-number {
      font-size: 14px;
      color: #71767b;
      font-weight: 600;
    }

    .episode-duration {
      font-size: 12px;
      color: #71767b;
    }

    .episode-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #ffffff;
    }

    .episode-description {
      font-size: 14px;
      color: #71767b;
      line-height: 1.4;
    }

    /* Reproductor de video mejorado */
    .video-player {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #000000;
      z-index: 4000;
      display: none;
    }

    .video-player.active {
      display: flex;
      flex-direction: column;
    }

    .video-player-container {
      flex: 1;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: none;
    }

    .video-player-container.show-cursor {
      cursor: default;
    }

    .video-player video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }

    /* Ocultar controles nativos */
    .video-player video::-webkit-media-controls,
    .video-player video::-webkit-media-controls-enclosure,
    .video-player video::-webkit-media-controls-panel,
    .video-player video::-webkit-media-controls-play-button,
    .video-player video::-webkit-media-controls-start-playback-button,
    .video-player video::-webkit-media-controls-timeline-container,
    .video-player video::-webkit-media-controls-current-time-display,
    .video-player video::-webkit-media-controls-time-remaining-display,
    .video-player video::-webkit-media-controls-timeline,
    .video-player video::-webkit-media-controls-volume-slider-container,
    .video-player video::-webkit-media-controls-volume-slider,
    .video-player video::-webkit-media-controls-mute-button,
    .video-player video::-webkit-media-controls-fullscreen-button,
    .video-player video::-webkit-media-controls-rewind-button,
    .video-player video::-webkit-media-controls-return-to-realtime-button,
    .video-player video::-webkit-media-controls-toggle-closed-captions-button {
      display: none !important;
      -webkit-appearance: none !important;
    }

    .video-player-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(rgba(0,0,0,0.8), transparent);
      padding: 20px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    .video-player-header.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .video-player-title {
      color: #ffffff;
      font-size: 18px;
      font-weight: 700;
    }

    .video-player-close {
      background: rgba(255,255,255,0.2);
      border: none;
      color: #ffffff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      backdrop-filter: blur(12px);
    }

    .video-player-controls {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      padding: 40px 16px 20px 16px;
      z-index: 10;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    .video-player-controls.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .video-progress-container {
      margin-bottom: 20px;
    }

    .video-progress {
      width: 100%;
      height: 4px;
      background: rgba(113, 118, 123, 0.3);
      border-radius: 2px;
      overflow: hidden;
      cursor: pointer;
    }

    .video-progress-fill {
      height: 100%;
      background: #1d9bf0;
      width: 0%;
      transition: width 0.1s linear;
    }

    .video-controls-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .video-controls-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .video-controls-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .video-control-btn {
      background: transparent;
      border: none;
      color: #ffffff;
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.2s ease;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .video-control-btn:hover {
      background: rgba(255,255,255,0.1);
    }

    .video-control-btn.play-pause {
      font-size: 24px;
    }

    .video-time {
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
    }

    /* Indicador de pausa */
    .pause-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      color: #ffffff;
      font-size: 64px;
      opacity: 0;
      transition: all 0.3s ease;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(12px);
      border-radius: 50%;
      width: 96px;
      height: 96px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .pause-indicator.visible {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }

    /* Indicador EN VIVO en el video */
    .video-live-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(255, 0, 0, 0.9);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      animation: livePulseVideo 2s ease-in-out infinite;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: liveDotPulse 1s ease-in-out infinite;
    }

    @keyframes livePulseVideo {
      0%, 100% {
        background: rgba(255, 0, 0, 0.9);
        box-shadow: 0 0 8px rgba(255, 0, 0, 0.4);
      }
      50% {
        background: rgba(255, 0, 0, 1);
        box-shadow: 0 0 16px rgba(255, 0, 0, 0.6);
      }
    }

    @keyframes liveDotPulse {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
      }
      50% {
        opacity: 0.7;
        transform: scale(1.2);
      }
    }

    /* Barra de navegación inferior */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(12px);
      border-top: 0.5px solid #333639;
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 1000;
    }

    .bottom-nav button {
      background: none;
      border: none;
      color: #71767b;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 50px;
      transition: all 0.2s ease;
      min-width: 80px;
    }

    .bottom-nav button:hover,
    .bottom-nav button.active {
      color: #1d9bf0;
      background: rgba(29, 155, 240, 0.1);
    }

    .bottom-nav button i {
      font-size: 24px;
      margin-bottom: 4px;
    }

    /* Sistema de bloqueo de pantalla estilo Netflix */
    .screen-lock-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 6000;
      display: none;
      backdrop-filter: blur(10px);
    }

    .screen-lock-overlay.active {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .lock-icon-container {
      margin-bottom: 20px;
      animation: lockPulseAnimation 2s ease-in-out infinite;
    }

    .lock-icon-container i {
      font-size: 80px;
      color: #ffffff;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }

    .lock-message {
      color: #ffffff;
      font-size: 18px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 30px;
      opacity: 0.9;
    }

    .unlock-button {
      background: linear-gradient(45deg, #1d9bf0, #00c9ff);
      border: none;
      color: #ffffff;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(29, 155, 240, 0.4);
    }

    .unlock-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(29, 155, 240, 0.6);
    }

    @keyframes lockPulseAnimation {
      0%, 100% {
        transform: scale(1);
        opacity: 0.8;
      }
      50% {
        transform: scale(1.1);
        opacity: 1;
      }
    }

    /* Botón de bloqueo en el reproductor */
    .screen-lock-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      border: none;
      color: #ffffff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(12px);
      z-index: 15;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .screen-lock-btn:hover {
      background: rgba(29, 155, 240, 0.8);
      border-color: rgba(29, 155, 240, 0.5);
      transform: scale(1.1);
    }

    /* Botón de descarga */
    .download-btn {
      background: rgba(0, 0, 0, 0.7);
      border: none;
      color: #ffffff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(12px);
      z-index: 15;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .download-btn:hover {
      background: rgba(29, 155, 240, 0.8);
      border-color: rgba(29, 155, 240, 0.5);
      transform: scale(1.1);
    }

    /* Orientación horizontal para móviles - Mejorado */
    @media screen and (orientation: landscape) and (max-height: 500px) {
      /* Forzar pantalla completa en landscape */
      .video-player.active {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        height: 100dvh !important; /* Dynamic viewport height para móviles modernos */
        z-index: 9999 !important;
        background: #000000 !important;
        transform: none !important;
      }

      /* Forzar orientación landscape automáticamente */
      .video-player.active .video-player-container {
        width: 100% !important;
        height: 100% !important;
        transform: none !important;
      }

      .video-player.active .video-player-container {
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        width: 100% !important;
        height: 100% !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        background: #000000 !important;
      }

      .video-player.active video {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain !important;
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        background: #000000 !important;
      }

      .video-player.active .video-player-header {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        background: linear-gradient(rgba(0,0,0,0.8), transparent);
        padding: 10px 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 100;
        height: auto;
      }

      .video-player.active .video-player-title {
        color: #ffffff;
        font-size: 16px;
        font-weight: 700;
      }

      .video-player.active .video-player-close {
        background: rgba(255,255,255,0.2);
        border: none;
        color: #ffffff;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        cursor: pointer;
        backdrop-filter: blur(12px);
      }

      .video-player.active .video-player-controls {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.8));
        padding: 20px 16px 10px 16px;
        z-index: 100;
      }

      .video-player.active .video-progress-container {
        margin-bottom: 10px;
      }

      .video-player.active .video-controls-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .video-player.active .video-control-btn {
        background: transparent;
        border: none;
        color: #ffffff;
        font-size: 18px;
        cursor: pointer;
        padding: 6px;
        border-radius: 50%;
        transition: all 0.2s ease;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .video-player.active .video-control-btn.play-pause {
        font-size: 20px;
      }

      .video-player.active .pause-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        color: #ffffff;
        font-size: 48px;
        opacity: 0;
        transition: all 0.3s ease;
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(12px);
        border-radius: 50%;
        width: 80px;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 50;
      }

      .video-player.active .pause-indicator.visible {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }

      /* Solo ocultar barra de navegación cuando el video esté activo en landscape */
      .video-player.active ~ .bottom-nav {
        display: none;
      }

      /* En móvil horizontal, mantener controles más tiempo visibles */
      .video-player.active .video-player-header.hidden {
        opacity: 0.1;
      }

      .video-player.active .video-player-controls.hidden {
        opacity: 0.1;
      }

      /* Asegurar que el big play button esté centrado solo cuando el video esté activo */
      .video-player.active #bigPlayButton {
        position: absolute !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        z-index: 60 !important;
      }

      /* Ocultar elementos de navegación en landscape */
      .video-player.active ~ .bottom-nav,
      .video-player.active ~ .header {
        display: none !important;
      }

      /* Forzar que el body no tenga scroll en landscape */
      body.video-playing {
        overflow: hidden !important;
        position: fixed !important;
        width: 100% !important;
        height: 100% !important;
      }
    }

    /* Soporte adicional para dispositivos móviles */
    @media screen and (max-width: 768px) {
      /* Permitir rotación automática */
      .video-player.active {
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
        -webkit-transition: -webkit-transform 0.3s ease;
        transition: transform 0.3s ease;
      }

      /* Optimizar para pantallas pequeñas */
      .video-player.active video {
        max-width: 100% !important;
        max-height: 100% !important;
        object-fit: contain !important;
      }
    }

    /* Forzar pantalla completa para iOS Safari */
    @media screen and (orientation: landscape) and (-webkit-min-device-pixel-ratio: 1) {
      .video-player.active {
        -webkit-appearance: none !important;
        -webkit-transform: translateZ(0) !important;
        transform: translateZ(0) !important;
      }
    }

    /* Estilos profesionales para subtítulos estilo Netflix */
    ::cue {
      font-family: 'Netflix Sans', 'Helvetica Neue', Arial, sans-serif;
      font-size: 20px;
      line-height: 1.2;
      color: #ffffff;
      background-color: rgba(0, 0, 0, 0.8);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.9);
      padding: 2px 6px;
      border-radius: 2px;
    }

    ::cue(.speaker) {
      color: #ffd700;
      font-style: italic;
    }

    ::cue(.sound-effect) {
      color: #1d9bf0;
      font-style: italic;
    }

    ::cue(.whisper) {
      font-size: 18px;
      opacity: 0.8;
    }

    ::cue(.loud) {
      font-weight: bold;
      color: #ff6b6b;
    }

    /* Animaciones suaves para aparición de subtítulos */
    video::cue {
      animation: subtitleFadeIn 0.3s ease-in-out;
    }

    @keyframes subtitleFadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero-title {
        font-size: 32px;
      }

      .carousel-item {
        width: 200px;
        height: 112px;
      }

      /* Vista detallada responsive */
      .series-detail-header {
        height: 65vh;
        padding: 20px 16px;
      }

      .series-detail-title {
        font-size: 28px;
        line-height: 1.2;
      }

      .series-detail-description {
        font-size: 15px;
        padding: 16px;
        line-height: 1.5;
      }

      .netflix-play-btn {
        width: 65px;
        height: 65px;
      }

      .netflix-play-btn i {
        font-size: 22px;
      }

      .series-btn {
        padding: 12px 20px;
        font-size: 15px;
        min-width: 130px;
      }

      .series-detail-meta {
        font-size: 13px;
        gap: 10px;
        flex-wrap: wrap;
      }

      .series-detail-meta span {
        padding: 3px 10px;
      }

      .sound-indicator {
        width: 36px;
        height: 36px;
        bottom: 90px;
        right: 16px;
      }

      .sound-indicator i {
        font-size: 14px;
      }

      .episode-thumbnail {
        width: 80px;
        height: 45px;
      }

      .series-detail-video {
        object-position: center center;
      }

      /* Ajustar subtítulos en móvil */
      ::cue {
        font-size: 16px;
        padding: 1px 4px;
      }

      ::cue(.whisper) {
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .series-detail-header {
        height: 60vh;
      }

      .series-detail-title {
        font-size: 28px;
      }

      .series-actions {
        flex-direction: column;
        gap: 12px;
      }

      .series-btn {
        width: 100%;
        justify-content: center;
      }
    }

    /* Ajustes adicionales para iOS Safari */
    @media screen and (orientation: landscape) and (max-height: 500px) and (-webkit-min-device-pixel-ratio: 1) {
      .video-player {
        /* Forzar altura completa en iOS */
        height: 100vh !important;
        height: 100svh !important; /* Para navegadores que soportan svh */
      }

      .video-player-container {
        height: 100vh !important;
        height: 100svh !important;
      }

      /* Ocultar la barra de estado de iOS */
      body.video-playing {
        overflow: hidden;
      }
    }

    .hidden {
      display: none;
    }
    .spinner {
      margin-left: 8px;
      color: #1d9bf0;
    }

    /* Sección de búsqueda */
    .search-section {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #000000;
      z-index: 2000;
      display: none;
      overflow-y: auto;
      padding-top: 80px;
    }

    .search-section.active {
      display: block;
    }

    .search-results-header {
      padding: 20px 16px;
      border-bottom: 1px solid #333639;
    }

    .search-results-title {
      font-size: 24px;
      font-weight: 800;
      color: #ffffff;
      margin-bottom: 8px;
    }

    .search-results-count {
      font-size: 14px;
      color: #71767b;
    }

    .search-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 16px;
      text-align: center;
    }

    .search-loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(29, 155, 240, 0.2);
      border-top: 3px solid #1d9bf0;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .search-loading-text {
      color: #71767b;
      font-size: 16px;
    }

    .search-results-grid {
      padding: 20px 16px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .search-result-item {
      background: #202327;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid #333639;
      position: relative;
    }

    .search-result-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 32px rgba(29, 155, 240, 0.3);
      border-color: #1d9bf0;
    }

    .search-result-poster {
      width: 100%;
      height: 200px;
      position: relative;
      overflow: hidden;
    }

    .search-result-poster img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .search-result-content {
      padding: 16px;
    }

    .search-result-title {
      font-size: 18px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 8px;
      line-height: 1.3;
    }

    .search-result-meta {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      font-size: 12px;
      color: #71767b;
      flex-wrap: wrap;
    }

    .search-result-description {
      font-size: 14px;
      color: #71767b;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .search-no-results {
      text-align: center;
      padding: 60px 16px;
      color: #71767b;
    }

    .search-no-results i {
      font-size: 48px;
      margin-bottom: 16px;
      display: block;
    }

    .search-no-results h3 {
      font-size: 20px;
      margin-bottom: 8px;
      color: #ffffff;
    }

    .search-close-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.75);
      border: none;
      color: #ffffff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(12px);
      z-index: 10;
    }

    .search-close-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.1);
    }

    @media (max-width: 768px) {
      .search-results-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .search-result-poster {
        height: 160px;
      }
    }

    /* Sección de Ajustes estilo Netflix */
    .settings-section {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #000000;
      z-index: 2000;
      display: none;
      overflow-y: auto;
      padding-top: 80px;
    }

    .settings-section.active {
      display: block;
    }

    .settings-close-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.75);
      border: none;
      color: #ffffff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(12px);
      z-index: 10;
    }

    .settings-close-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.1);
    }

    .settings-header {
      padding: 20px 16px 30px 16px;
      border-bottom: 1px solid #333639;
    }

    .settings-title {
      font-size: 28px;
      font-weight: 800;
      color: #ffffff;
      margin-bottom: 8px;
    }

    .settings-subtitle {
      font-size: 16px;
      color: #71767b;
    }

    .settings-content {
      padding: 20px 16px;
      max-width: 600px;
      margin: 0 auto;
    }

    .settings-group {
      margin-bottom: 32px;
      background: rgba(32, 35, 39, 0.5);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #333639;
    }

    .settings-group-title {
      font-size: 18px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .settings-group-title i {
      color: #1d9bf0;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid rgba(51, 54, 57, 0.5);
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    .setting-info {
      flex: 1;
    }

    .setting-name {
      font-size: 16px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 4px;
    }

    .setting-description {
      font-size: 14px;
      color: #71767b;
      line-height: 1.4;
    }

    .setting-select {
      background: #202327;
      border: 1px solid #333639;
      color: #ffffff;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      min-width: 120px;
      cursor: pointer;
    }

    .setting-select:focus {
      outline: none;
      border-color: #1d9bf0;
      box-shadow: 0 0 0 2px rgba(29, 155, 240, 0.2);
    }

    /* Toggle switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #333639;
      transition: 0.3s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: #1d9bf0;
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    .settings-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 32px;
      padding-top: 20px;
      border-top: 1px solid #333639;
    }

    .settings-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .settings-btn.primary {
      background: #1d9bf0;
      color: #ffffff;
    }

    .settings-btn.primary:hover {
      background: #1a8cd8;
    }

    .settings-btn.secondary {
      background: transparent;
      color: #71767b;
      border: 1px solid #333639;
    }

    .settings-btn.secondary:hover {
      background: rgba(113, 118, 123, 0.1);
      color: #ffffff;
    }

    @media (max-width: 768px) {
      .settings-content {
        padding: 20px 16px;
      }

      .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .settings-actions {
        flex-direction: column;
      }

      .settings-btn {
        width: 100%;
        justify-content: center;
      }
    }

    /* Sección VIP completa */
    .vip-section {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #000000;
      z-index: 2000;
      display: none;
      overflow-y: auto;
      padding-top: 80px;
    }

    .vip-section.active {
      display: block;
    }

    .vip-close-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.75);
      border: none;
      color: #ffffff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(12px);
      z-index: 10;
    }

    .vip-close-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.1);
    }

    .vip-header {
      padding: 20px 16px 30px 16px;
      border-bottom: 1px solid #333639;
      text-align: center;
    }

    .vip-title {
      font-size: 28px;
      font-weight: 800;
      color: #ffffff;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .vip-title i {
      color: #ffd700;
      font-size: 32px;
    }

    .vip-subtitle {
      font-size: 16px;
      color: #71767b;
    }

    .vip-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 16px;
      text-align: center;
    }

    .vip-loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 215, 0, 0.2);
      border-top: 3px solid #ffd700;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    .vip-loading-text {
      color: #71767b;
      font-size: 16px;
    }

    .vip-no-users {
      text-align: center;
      padding: 60px 16px;
      color: #71767b;
    }

    .vip-no-users i {
      font-size: 48px;
      margin-bottom: 16px;
      display: block;
      color: #ffd700;
    }

    .vip-no-users h3 {
      font-size: 20px;
      margin-bottom: 8px;
      color: #ffffff;
    }

    /* Estilos para la sección VIP */
    .vip-users-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      padding: 20px 16px;
    }

    .vip-user-card {
      background: #202327;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #333639;
      display: flex;
      align-items: center;
      gap: 16px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .vip-user-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 32px rgba(29, 155, 240, 0.3);
      border-color: #1d9bf0;
    }

    .vip-user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
      position: relative;
    }

    .vip-user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .vip-user-info {
      flex-grow: 1;
    }

    .vip-user-name {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 16px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 4px;
    }

    .vip-verified {
      color: #1d9bf0;
      font-size: 14px;
    }

    .vip-followers-count {
      font-size: 13px;
      color: #71767b;
      font-weight: 500;
    }

    .vip-follow-btn {
      background: #1d9bf0;
      color: #ffffff;
      border: none;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .vip-follow-btn:hover {
      background: #1a8cd8;
    }

    .vip-follow-btn.following {
      background: #333639;
      color: #ffffff;
      border: 1px solid #71767b;
    }

    .vip-follow-btn.following:hover {
      background: #44474a;
      border-color: #909497;
    }

    .vip-follow-btn i {
      font-size: 14px;
    }

    /* Animación especial para coronas de usuarios exclusivos */
    @keyframes crownPulse {
      0%, 100% {
        transform: translateX(-50%) scale(1);
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
      }
      50% {
        transform: translateX(-50%) scale(1.1);
        filter: drop-shadow(0 4px 8px rgba(255,215,0,0.8));
      }
    }

    .vip-user-card .fa-crown {
      animation: crownPulse 3s ease-in-out infinite;
    }

    /* Efecto especial para usuarios exclusivos */
    .vip-user-card[data-user-type="exclusive"] {
      border: 2px solid rgba(255, 215, 0, 0.3);
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), rgba(255, 215, 0, 0.1));
      box-shadow: 0 4px 20px rgba(255, 215, 0, 0.2);
    }

    .vip-user-card[data-user-type="exclusive"]:hover {
      border-color: rgba(255, 215, 0, 0.6);
      box-shadow: 0 8px 32px rgba(255, 215, 0, 0.4);
    }

    @media (max-width: 768px) {
      .vip-users-container {
        grid-template-columns: 1fr;
      }
    }

  </style>
</head>
<body>
  <!-- Header de búsqueda -->
  <header class="header">
    <div class="search-container">
      <div class="search-wrapper">
        <div class="search-icon">
          <i class="fas fa-search"></i>
        </div>
        <input type="text" id="searchInput" placeholder="Buscar series y películas">
        <button class="search-btn" id="searchBtn">
          <i class="fas fa-arrow-right"></i>
        </button>
        <div id="searchSpinner" class="spinner hidden">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
      </div>
    </div>
  </header>

  <!-- Sección principal -->
  <div id="homeSection" class="app-container">
    <!-- Banner principal -->
    <div class="hero-banner" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.8)), url('https://i.ytimg.com/vi/4f3hG-5grlw/maxresdefault.jpg');">
      <div class="hero-content">
        <h1 class="hero-title">NO TE MUEVAS</h1>
        <p class="hero-description">Una aterradora experiencia cinematográfica que desafía los límites del horror psicológico.</p>

        <div class="hero-buttons">
          <button class="hero-btn primary" onclick="playEpisode(1, 1)" id="heroBannerPlay">
            <i class="fas fa-play"></i>
            Reproducir
          </button>
          <button class="hero-btn secondary" onclick="playTrailer()">
            <i class="fas fa-film"></i>
            Ver Trailer
          </button>
          <button class="hero-btn secondary" onclick="showSeriesDetail('dontlookaway')">
            <i class="fas fa-info-circle"></i>
            Más Info
          </button>
        </div>
      </div>
    </div>

    <!-- Secciones de contenido -->
    <div class="content-sections">
      <!-- Películas -->
      <div class="section">
        <h2 class="section-title">Películas</h2>
        <div class="carousel-container">
          <div class="carousel" id="moviesCarousel">
            <div class="carousel-item" onclick="showSeriesDetail('dontlookaway')">
              <img src="https://i.ytimg.com/vi/4f3hG-5grlw/maxresdefault.jpg" alt="DON'T LOOK AWAY">
              <div class="movie-badge">Película</div>
              <div class="carousel-item-overlay">
                <div class="carousel-item-title">DON'T LOOK AWAY</div>
                <div class="carousel-item-info">2025 • Terror • Thriller</div>
              </div>
            </div>
            <div class="carousel-item" onclick="handleMovieClick('notemuevas')">
              <img src="https://i.ibb.co/DDh79krZ/image.png" alt="NO TE MUEVAS">
              <div class="movie-badge">Película</div>
              <div id="notemuevas-badge" class="premiere-badge">Estreno</div>
              <div class="carousel-item-overlay">
                <div class="carousel-item-title">NO TE MUEVAS</div>
                <div class="carousel-item-info">2025 • Terror</div>
              </div>
            </div>
            <div class="carousel-item" onclick="showSeriesDetail('doublevision')">
              <img src="https://m.media-amazon.com/images/M/MV5BODZiOGIxZTQtZjA2My00NzY3LTlkZTktZmFlZjJkOThhN2NjXkEyXkFqcGc@._V1_QL75_UX190_CR0,2,190,281_.jpg" alt="DOUBLE VISION">
              <div class="movie-badge">Película</div>
              <div class="carousel-item-overlay">
                <div class="carousel-item-title">DOUBLE VISION</div>
                <div class="carousel-item-info">2025 • Terror</div>
              </div>
            </div>
            <div class="carousel-item" onclick="showSeriesDetail('thecandleman')">
              <img src="https://i.ytimg.com/vi/i229gWn3Z5A/maxresdefault.jpg" alt="THE CANDLE MAN">
              <div class="movie-badge">Cortometraje</div>
              <div class="carousel-item-overlay">
                <div class="carousel-item-title">THE CANDLE MAN</div>
                <div class="carousel-item-info">2024 • Terror</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tendencias -->
      <div class="section">
        <h2 class="section-title">Tendencias</h2>
        <div class="carousel-container">
          <div class="carousel" id="trendingCarousel">
            <div class="carousel-item" onclick="showSeriesDetail('dontlookaway')">
              <img src="https://i0.wp.com/lugarnenhum.net/wp-content/uploads/2019/02/dont-look-away-e1549769239207-1024x512.png?resize=1024%2C512&ssl=1" alt="DON'T LOOK AWAY">
              <div class="movie-badge">Película</div>
              <div class="carousel-item-overlay">
                <div class="carousel-item-title">DON'T LOOK AWAY</div>
                <div class="carousel-item-info">2025 • Terror</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Anime -->
      <div class="section">
        <h2 class="section-title">Anime</h2>
        <div class="carousel-container">
          <div class="carousel" id="animeCarousel">

          </div>
        </div>
      </div>

      <!-- Terror -->
      <div class="section">
        <h2 class="section-title">Terror</h2>
        <div class="carousel-container">
          <div class="carousel" id="terrorCarousel">
            <div class="carousel-item" onclick="handleMovieClick('notemuevas')">
              <img src="https://i.ibb.co/DDh79krZ/image.png" alt="NO TE MUEVAS">
              <div class="movie-badge">Película</div>
              <div id="notemuevas-badge" class="premiere-badge">Estreno</div>
              <div class="carousel-item-overlay">
                <div class="carousel-item-title">NO TE MUEVAS</div>
                <div class="carousel-item-info">2025 • Terror</div>
              </div>
            </div>
            <div class="carousel-item" onclick="showSeriesDetail('doublevision')">
              <img src="https://m.media-amazon.com/images/M/MV5BODZiOGIxZTQtZjA2My00NzY3LTlkZTktZmFlZjJkOThhN2NjXkEyXkFqcGc@._V1_QL75_UX190_CR0,2,190,281_.jpg" alt="DOUBLE VISION">
              <div class="movie-badge">Película</div>
              <div class="carousel-item-overlay">
                <div class="carousel-item-title">DOUBLE VISION</div>
                <div class="carousel-item-info">2025 • Terror</div>
              </div>
            </div>
            <div class="carousel-item" onclick="showSeriesDetail('dontlookaway')">
              <img src="https://i.ytimg.com/vi/4f3hG-5grlw/maxresdefault.jpg" alt="DON'T LOOK AWAY">
              <div class="movie-badge">Película</div>
              <div class="carousel-item-overlay">
                <div class="carousel-item-title">DON'T LOOK AWAY</div>
                <div class="carousel-item-info">Película completa</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      
    </div>
  </div>

  <!-- Vista detallada de serie -->
  <div id="seriesDetail" class="series-detail">
    <div class="series-detail-header" id="seriesDetailHeader">
      <!-- Imagen de fondo -->
      <div class="series-detail-background" id="seriesDetailBackground"></div>

      <!-- Video de trailer de fondo -->
      <video class="series-detail-video" id="seriesDetailVideo"
             muted autoplay loop playsinline webkit-playsinline x5-playsinline
             style="display: none;">
      </video>

      <!-- Overlay gradiente -->
      <div class="series-detail-overlay"></div>

      <!-- Botón de play circular -->
      <div class="netflix-play-btn" id="netflixPlayBtn" onclick="playMainMovie()">
        <i class="fas fa-play"></i>
      </div>

      <!-- Indicador de sonido -->
      <div class="sound-indicator" id="soundToggle" onclick="toggleTrailerSound()">
        <i class="fas fa-volume-mute"></i>
      </div>

      <!-- Botón de cerrar -->
      <button class="series-close-btn" onclick="closeSeriesDetail()">
        <i class="fas fa-times"></i>
      </button>

      <!-- Contenido de texto -->
      <div class="series-detail-content">
        <h1 class="series-detail-title" id="seriesDetailTitle">DON'T LOOK AWAY</h1>
        <div class="series-detail-meta" id="seriesDetailMeta">
          <span>2025</span>
          <span>Película</span>
          <span>Terror</span>
          <span>18+</span>
        </div>
        <p class="series-detail-description" id="seriesDetailDescription">
          Una aterradora experiencia cinematográfica que desafía los límites del horror psicológico.
        </p>
      </div>
    </div>

    <div class="series-actions">
      <button class="series-btn primary" id="playButton" onclick="playEpisode(1, 1)">
        <i class="fas fa-play"></i>
        Reproducir
      </button>
      <button class="series-btn secondary" onclick="playTrailer()">
        <i class="fas fa-film"></i>
        Trailer
      </button>
    </div>

    <div class="episodes-section">
      <h3 class="episodes-title">Película</h3>
      <div id="episodesList">
        <!-- Los episodios se cargarán dinámicamente -->
      </div>
    </div>

    <!-- Sección de calificaciones -->
    <div class="rating-section" id="ratingSection">
      <div class="rating-title">
        <i class="fas fa-thumbs-up"></i>
        ¿Te gustó este contenido?
      </div>
      <div class="rating-buttons">
        <button class="rating-btn good" onclick="rateContent('good')" id="goodBtn">
          <i class="fas fa-thumbs-up"></i>
          <span>Bueno</span>
          <span class="rating-count" id="goodCount">0</span>
        </button>
        <button class="rating-btn bad" onclick="rateContent('bad')" id="badBtn">
          <i class="fas fa-thumbs-down"></i>
          <span>Malo</span>
          <span class="rating-count" id="badCount">0</span>
        </button>
      </div>
      <div class="rating-stats">
        <div class="rating-stats-title">Estadísticas de calificación</div>
        <div class="rating-bar">
          <span class="rating-label">Bueno</span>
          <div class="rating-progress">
            <div class="rating-progress-fill good" id="goodProgress" style="width: 0%"></div>
          </div>
          <span class="rating-percentage" id="goodPercentage">0%</span>
        </div>
        <div class="rating-bar">
          <span class="rating-label">Malo</span>
          <div class="rating-progress">
            <div class="rating-progress-fill bad" id="badProgress" style="width: 0%"></div>
          </div>
          <span class="rating-percentage" id="badPercentage">0%</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Reproductor de video -->
  <div id="videoPlayer" class="video-player">
    <div class="video-player-container">
      <div class="video-player-header">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div class="video-player-title" id="videoPlayerTitle">Reproduciendo...</div>
          <div id="videoLiveIndicator" class="video-live-indicator" style="display: none;">
            <div class="live-dot"></div>
            <span>EN VIVO</span>
          </div>
        </div>
        <div style="display: flex; gap: 10px;">
          <button class="screen-lock-btn" onclick="lockScreen()" title="Bloquear pantalla">
            <i class="fas fa-lock"></i>
          </button>
          <button class="download-btn" onclick="downloadCurrentContent()" title="Descargar película" style="background: rgba(0, 0, 0, 0.7); border: none; color: #ffffff; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; transition: all 0.2s ease; backdrop-filter: blur(12px); z-index: 15; border: 2px solid rgba(255, 255, 255, 0.2);">
            <i class="fas fa-download"></i>
          </button>
          <button class="video-player-close" onclick="closeVideoPlayer()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <video id="videoElement"
             playsinline
             webkit-playsinline
             x5-playsinline
             preload="metadata">
      </video>

      <div class="pause-indicator" id="pauseIndicator">
        <i class="fas fa-pause"></i>
      </div>

      <div class="video-player-controls">
        <div class="video-progress-container">
          <div class="video-progress" id="videoProgress">
            <div class="video-progress-fill" id="videoProgressFill"></div>
          </div>
        </div>
        <div class="video-controls-row">
          <div class="video-controls-left">
            <button class="video-control-btn play-pause" id="playPauseBtn" onclick="togglePlayPause()">
              <i class="fas fa-play"></i>
            </button>
            <button class="video-control-btn" onclick="rewind()">
              <i class="fas fa-backward"></i>
            </button>
            <button class="video-control-btn" onclick="forward()">
              <i class="fas fa-forward"></i>
            </button>
            <div class="video-time">
              <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
            </div>
          </div>
          <div class="video-controls-right">
            <button class="video-control-btn" id="audioLanguageBtn" onclick="toggleAudioLanguage()">
              <i class="fas fa-language"></i>
            </button>
            <button class="video-control-btn" id="volumeBtn" onclick="toggleMute()">
              <i class="fas fa-volume-up"></i>
            </button>
            <button class="video-control-btn" id="subtitlesBtn" onclick="toggleSubtitles()">
              <i class="fas fa-closed-captioning"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay de bloqueo de pantalla -->
  <div id="screenLockOverlay" class="screen-lock-overlay">
    <div class="lock-icon-container">
      <i class="fas fa-lock"></i>
    </div>
    <div class="lock-message">
      Pantalla bloqueada<br>
      Toca para desbloquear
    </div>
    <button class="unlock-button" onclick="unlockScreen()">
      <i class="fas fa-unlock"></i> Desbloquear
    </button>
  </div>

  <!-- Sección de búsqueda -->
  <div id="searchSection" class="search-section">
    <button class="search-close-btn" onclick="closeSearchSection()">
      <i class="fas fa-times"></i>
    </button>

    <div class="search-results-header">
      <div class="search-results-title" id="searchResultsTitle">Resultados de búsqueda</div>
      <div class="search-results-count" id="searchResultsCount"></div>
    </div>

    <div id="searchLoading" class="search-loading hidden">
      <div class="search-loading-spinner"></div>
      <div class="search-loading-text">Buscando contenido...</div>
    </div>

    <div id="searchResultsGrid" class="search-results-grid">
      <!-- Los resultados se cargarán aquí -->
    </div>

    <div id="searchNoResults" class="search-no-results hidden">
      <i class="fas fa-search"></i>
      <h3>No se encontraron resultados</h3>
      <p>Intenta con otros términos de búsqueda</p>
    </div>
  </div>

  <!-- Sección VIP -->
  <div id="vipSection" class="vip-section">
    <button class="vip-close-btn" onclick="closeVipSection()">
      <i class="fas fa-times"></i>
    </button>

    <div class="vip-header">
      <h2 class="vip-title">
        <i class="fas fa-crown"></i>
        Usuarios VIP
      </h2>
      <p class="vip-subtitle">Conecta con otros usuarios destacados de la plataforma</p>
    </div>

    <div id="vipLoading" class="vip-loading hidden">
      <div class="vip-loading-spinner"></div>
      <div class="vip-loading-text">Cargando usuarios VIP...</div>
    </div>

    <div id="vipUsersContainer" class="vip-users-container">
      <!-- Los usuarios VIP se cargarán dinámicamente desde Firebase -->
    </div>

    <div id="vipNoUsers" class="vip-no-users hidden">
      <i class="fas fa-crown"></i>
      <h3>No hay usuarios VIP aún</h3>
      <p>Los usuarios VIP aparecerán aquí cuando se registren en la plataforma</p>
    </div>
  </div>

  <!-- Sección de Ajustes -->
  <div id="settingsSection" class="settings-section">
    <button class="settings-close-btn" onclick="closeSettingsSection()">
      <i class="fas fa-times"></i>
    </button>

    <div class="settings-header">
      <h2 class="settings-title">Configuración</h2>
      <p class="settings-subtitle">Personaliza tu experiencia de visualización</p>
    </div>

    <div class="settings-content">
      <div class="settings-group">
        <h3 class="settings-group-title">
          <i class="fas fa-video"></i>
          Reproducción
        </h3>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Reproducción automática</div>
            <div class="setting-description">Reproducir automáticamente el siguiente episodio</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="autoplayToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Calidad de video</div>
            <div class="setting-description">Seleccionar calidad predeterminada</div>
          </div>
          <select class="setting-select" id="videoQuality">
            <option value="auto">Automática</option>
            <option value="1080p">1080p HD</option>
            <option value="720p">720p HD</option>
            <option value="480p">480p</option>
          </select>
        </div>
      </div>

      <div class="settings-group">
        <h3 class="settings-group-title">
          <i class="fas fa-language"></i>
          Idioma y Audio
        </h3>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Idioma de la interfaz</div>
            <div class="setting-description">Cambiar idioma de la aplicación</div>
          </div>
          <select class="setting-select" id="interfaceLanguage" onchange="handleLanguageChange(this.value)">
            <option value="es">Español</option>
            <option value="en">English</option>
            <option value="pt">Português</option>
          </select>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Audio preferido</div>
            <div class="setting-description">Idioma de audio predeterminado</div>
          </div>
          <select class="setting-select" id="preferredAudio">
            <option value="original">Audio original</option>
            <option value="es">Español</option>
            <option value="en">English</option>
          </select>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Subtítulos</div>
            <div class="setting-description">Mostrar subtítulos por defecto</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="defaultSubtitles">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="settings-group">
        <h3 class="settings-group-title">
          <i class="fas fa-bell"></i>
          Notificaciones
        </h3>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Nuevos estrenos</div>
            <div class="setting-description">Notificar sobre nuevas películas y series</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="releaseNotifications" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Recordatorios</div>
            <div class="setting-description">Recordar contenido pausado</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="reminderNotifications" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="settings-group">
        <h3 class="settings-group-title">
          <i class="fas fa-shield-alt"></i>
          Control Parental
        </h3>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Contenido para menores</div>
            <div class="setting-description">Filtrar contenido por clasificación</div>
          </div>
          <select class="setting-select" id="parentalControl">
            <option value="all">Todo el contenido</option>
            <option value="13+">13+ y menor</option>
            <option value="pg">Solo contenido familiar</option>
          </select>
        </div>
      </div>

      <div class="settings-group">
        <h3 class="settings-group-title">
          <i class="fas fa-user"></i>
          Cuenta
        </h3>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Perfil Actual</div>
            <div class="setting-description" id="currentProfileName">Cargando...</div>
          </div>
          <div id="userAvatar" style="width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px;"></div>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Cerrar Sesión</div>
            <div class="setting-description">Salir de tu cuenta de IBTV</div>
          </div>
          <button class="settings-btn secondary" onclick="logoutFirebase()" style="width: auto; padding: 8px 16px; font-size: 14px;">
            <i class="fas fa-sign-out-alt"></i>
            Salir
          </button>
        </div>
      </div>

      <div class="settings-actions">
        <button class="settings-btn secondary" onclick="resetSettings()">
          <i class="fas fa-undo"></i>
          Restablecer
        </button>
        <button class="settings-btn primary" onclick="saveSettings()">
          <i class="fas fa-save"></i>
          Guardar Cambios
        </button>
      </div>
    </div>
  </div>

  <!-- Navegación inferior -->
  <nav class="bottom-nav">
    <button id="navHome" class="active">
      <i class="fas fa-home"></i>
      <span>Inicio</span>
    </button>
    <button id="navSearch">
      <i class="fas fa-search"></i>
      <span>Buscar</span>
    </button>
    <button id="navVip">
      <i class="fas fa-crown"></i>
      <span>VIP</span>
    </button>
    <button id="navSettings">
      <i class="fas fa-cog"></i>
      <span>Ajustes</span>
    </button>
  </nav>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    // Configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCFQ_geG0HIv2EZ-bfKc97TJNtf2sdqPzc",
      authDomain: "clack-koder.firebaseapp.com",
      databaseURL: "https://clack-koder-default-rtdb.firebaseio.com",
      projectId: "clack-koder",
      storageBucket: "clack-koder.firebasestorage.app",
      messagingSenderId: "478151254938",
      appId: "1:478151254938:web:e2c00e3a5426bd192b9023",
      measurementId: "G-P29ME5Z3S1"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    let currentFirebaseUser = null;
    let userProfile = null;

    // Función para verificar autenticación con Firebase
    function checkAuthentication() {
      return new Promise((resolve) => {
        auth.onAuthStateChanged(async (user) => {
          if (user) {
            currentFirebaseUser = user;

            // Verificar que tenga suscripción y perfil
            try {
              const userRef = database.ref('users/' + user.uid);
              const snapshot = await userRef.once('value');
              const userData = snapshot.val();

              if (!userData || !userData.subscription) {
                window.location.href = 'subscription.html';
                return;
              }

              if (!userData.profile) {
                window.location.href = 'profile-setup.html';
                return;
              }

              // Usuario completo, cargar datos
              userProfile = userData.profile;
              updateUserInterface();
              resolve(true);

            } catch (error) {
              console.error('Error verificando usuario:', error);
              window.location.href = 'auth.html';
            }
          } else {
            window.location.href = 'auth.html';
          }
        });
      });
    }

    // Actualizar interfaz con datos del usuario
    function updateUserInterface() {
      if (userProfile) {
        // Actualizar avatar del usuario en ajustes si existe
        const userAvatar = document.getElementById('userAvatar');
        if (userAvatar && userProfile.avatar) {
          const avatarData = userProfile.avatar.data;
          if (avatarData.type === 'icon') {
            userAvatar.innerHTML = `<i class="fas ${avatarData.icon}"></i>`;
            userAvatar.style.background = avatarData.gradient;
          }
        }

        // Guardar datos en localStorage para compatibilidad
        localStorage.setItem('ibtv_user_profile', JSON.stringify(userProfile));
        localStorage.setItem('ibtv_subscription', 'active');
      }
    }

    // Función para cerrar sesión de Firebase
    function logoutFirebase() {
      auth.signOut().then(() => {
        localStorage.clear();
        window.location.href = 'auth.html';
      }).catch((error) => {
        console.error('Error cerrando sesión:', error);
      });
    }

    // Variables globales necesarias
    let isScreenLocked = false;
    let isPlayingIntro = false;
    let controlsTimeout = null;

    // URL del intro de IBTV
    const introVideoUrl = 'https://dl.dropboxusercontent.com/scl/fi/h5ekhsy1045o93jdnp6ff/video_BAACAgEAAxkBAAIBimg_Hd9a9bpAMm37Sz-eBpNb-0gZAAKnBgAC_aH4RQ4rFHrAoNZHNgQ.mp4?rlkey=hpz7w3qyd67yboabi09svgl64&st=embhl2dy';

    // Función para manejar clics de películas especiales
    function handleMovieClick(movieId) {
      if (movieId === 'notemuevas') {
        showSeriesDetail('notemuevas');
      }
    }

    // Función para inicializar el sistema de estreno
    function initializePremiereSystem() {
      // Cargar calificaciones
      loadRatings();

      // Configurar navegación
      setupNavigation();

      // Configurar búsqueda
      setupSearch();

      // Actualizar indicadores cada minuto
      updateReleaseIndicators();
      setInterval(updateReleaseIndicators, 60000);

      // El sistema VIP ahora carga dinámicamente desde Firebase
    }

    // Sistema de navegación
    function setupNavigation() {
      const navButtons = document.querySelectorAll('.bottom-nav button');

      navButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Remover active de todos
          navButtons.forEach(btn => btn.classList.remove('active'));

          // Agregar active al clickeado
          this.classList.add('active');

          // Manejar navegación
          const buttonId = this.id;

          if (buttonId === 'navHome') {
            showHomeSection();
          } else if (buttonId === 'navSearch') {
            showSearchSection();
          } else if (buttonId === 'navVip') {
            showVipSection();
          } else if (buttonId === 'navSettings') {
            showSettingsSection();
          }
        });
      });
    }

    // Mostrar sección home
    function showHomeSection() {
      hideAllSections();
      document.getElementById('homeSection').style.display = 'block';
    }

    // Mostrar sección de búsqueda
    function showSearchSection() {
      hideAllSections();
      document.getElementById('searchSection').classList.add('active');
    }

    // Mostrar sección VIP
    function showVipSection() {
      hideAllSections();
      document.getElementById('vipSection').classList.add('active');
      loadVipUsers();
    }

    // Mostrar sección de ajustes
    function showSettingsSection() {
      hideAllSections();
      document.getElementById('settingsSection').classList.add('active');
      loadCurrentSettings();
    }

    // Ocultar todas las secciones
    function hideAllSections() {
      document.getElementById('homeSection').style.display = 'none';
      document.getElementById('searchSection').classList.remove('active');
      document.getElementById('vipSection').classList.remove('active');
      document.getElementById('settingsSection').classList.remove('active');
    }

    // Cerrar sección de búsqueda
    function closeSearchSection() {
      document.getElementById('searchSection').classList.remove('active');
      showHomeSection();

      // Activar botón home
      document.querySelectorAll('.bottom-nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById('navHome').classList.add('active');
    }

    // Cerrar sección VIP
    function closeVipSection() {
      document.getElementById('vipSection').classList.remove('active');
      showHomeSection();

      // Activar botón home
      document.querySelectorAll('.bottom-nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById('navHome').classList.add('active');
    }

    // Cerrar sección de ajustes
    function closeSettingsSection() {
      document.getElementById('settingsSection').classList.remove('active');
      showHomeSection();

      // Activar botón home
      document.querySelectorAll('.bottom-nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById('navHome').classList.add('active');
    }

    // Sistema de búsqueda
    function setupSearch() {
      const searchInput = document.getElementById('searchInput');
      const searchBtn = document.getElementById('searchBtn');

      searchBtn.addEventListener('click', performSearch);
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
    }

    // Realizar búsqueda
    function performSearch() {
      const query = document.getElementById('searchInput').value.trim();
      if (!query) return;

      showSearchSection();

      // Mostrar loading
      document.getElementById('searchLoading').classList.remove('hidden');
      document.getElementById('searchResultsGrid').innerHTML = '';
      document.getElementById('searchNoResults').classList.add('hidden');

      // Simular búsqueda
      setTimeout(() => {
        const results = searchContent(query);
        displaySearchResults(results, query);
        document.getElementById('searchLoading').classList.add('hidden');
      }, 1000);
    }

    // Buscar contenido
    function searchContent(query) {
      const results = [];
      const lowerQuery = query.toLowerCase();

      Object.values(seriesDatabase).forEach(series => {
        if (series.title.toLowerCase().includes(lowerQuery) ||
            series.description.toLowerCase().includes(lowerQuery) ||
            series.genre.toLowerCase().includes(lowerQuery)) {
          results.push(series);
        }
      });

      return results;
    }

    // Mostrar resultados de búsqueda
    function displaySearchResults(results, query) {
      const resultsGrid = document.getElementById('searchResultsGrid');
      const noResults = document.getElementById('searchNoResults');
      const resultsTitle = document.getElementById('searchResultsTitle');
      const resultsCount = document.getElementById('searchResultsCount');

      resultsTitle.textContent = `Resultados para "${query}"`;
      resultsCount.textContent = `${results.length} resultado${results.length !== 1 ? 's' : ''} encontrado${results.length !== 1 ? 's' : ''}`;

      if (results.length === 0) {
        noResults.classList.remove('hidden');
        return;
      }

      resultsGrid.innerHTML = '';

      results.forEach(series => {
        const resultItem = document.createElement('div');
        resultItem.className = 'search-result-item';
        resultItem.onclick = () => showSeriesDetail(series.id);

        resultItem.innerHTML = `
          <div class="search-result-poster">
            <img src="${series.poster}" alt="${series.title}">
          </div>
          <div class="search-result-content">
            <h3 class="search-result-title">${series.title}</h3>
            <div class="search-result-meta">
              <span>${series.year}</span>
              <span>${series.type === 'movie' ? 'Película' : 'Serie'}</span>
              <span>${series.rating}</span>
            </div>
            <p class="search-result-description">${series.description}</p>
          </div>
        `;

        resultsGrid.appendChild(resultItem);
      });
    }

    // Sistema VIP con usuarios reales de Firebase
    async function loadVipUsers() {
      const vipContainer = document.getElementById('vipUsersContainer');
      const vipLoading = document.getElementById('vipLoading');
      const vipNoUsers = document.getElementById('vipNoUsers');

      // Mostrar loading
      vipLoading.classList.remove('hidden');
      vipContainer.innerHTML = '';
      vipNoUsers.classList.add('hidden');

      try {
        console.log('Cargando usuarios VIP desde Firebase...');

        // Obtener todos los usuarios registrados primero
        const usersRef = database.ref('users');
        const usersSnapshot = await usersRef.once('value');
        const allUsers = usersSnapshot.val();

        console.log('Usuarios encontrados:', allUsers ? Object.keys(allUsers).length : 0);

        vipLoading.classList.add('hidden');

        if (!allUsers) {
          console.log('No hay usuarios en la base de datos');
          vipNoUsers.classList.remove('hidden');
          return;
        }

        // Crear lista de usuarios VIP
        const vipUsersList = [];

        // Recorrer todos los usuarios y buscar los que son VIP o exclusivos
        Object.keys(allUsers).forEach(userId => {
          const user = allUsers[userId];
          console.log(`Revisando usuario ${user.email}:`, {
            exclusive: user.exclusive,
            subscription: user.subscription
          });

          // Verificar si el usuario es exclusivo (marcado directamente como exclusive: true)
          if (user.exclusive === true) {
            console.log(`Usuario exclusivo encontrado: ${user.email}`);
            vipUsersList.push({
              uid: userId,
              ...user,
              vipType: 'exclusive',
              isExclusive: true,
              followers: user.followers || Math.floor(Math.random() * 500) + 100 // Seguidores aleatorios si no existen
            });
          }
          // Verificar si es colaborador
          else if (user.subscription && user.subscription.type === 'collaborator') {
            console.log(`Colaborador encontrado: ${user.email}`);
            vipUsersList.push({
              uid: userId,
              ...user,
              vipType: 'collaborator',
              followers: user.followers || Math.floor(Math.random() * 200) + 50
            });
          }
          // Verificar si tiene suscripción activa y puede ser VIP
          else if (user.subscription && user.subscription.status === 'active') {
            console.log(`Usuario activo encontrado: ${user.email}`);
            vipUsersList.push({
              uid: userId,
              ...user,
              vipType: 'vip',
              followers: user.followers || Math.floor(Math.random() * 300) + 75
            });
          }
        });

        // También buscar en el nodo vip_users específico
        try {
          const vipUsersRef = database.ref('vip_users');
          const vipSnapshot = await vipUsersRef.once('value');
          const vipUsers = vipSnapshot.val();

          if (vipUsers) {
            console.log('Usuarios VIP específicos encontrados:', Object.keys(vipUsers).length);
            Object.keys(vipUsers).forEach(userId => {
              if (allUsers[userId] && vipUsers[userId].isVip) {
                // Solo agregar si no está ya en la lista
                const alreadyExists = vipUsersList.some(user => user.uid === userId);
                if (!alreadyExists) {
                  vipUsersList.push({
                    uid: userId,
                    ...allUsers[userId],
                    vipType: 'vip',
                    followers: vipUsers[userId].followers || Math.floor(Math.random() * 400) + 100
                  });
                }
              }
            });
          }
        } catch (vipError) {
          console.log('No se encontró nodo vip_users específico:', vipError);
        }

        // También buscar en el nodo exclusive_users específico
        try {
          const exclusiveUsersRef = database.ref('exclusive_users');
          const exclusiveSnapshot = await exclusiveUsersRef.once('value');
          const exclusiveUsers = exclusiveSnapshot.val();

          if (exclusiveUsers) {
            console.log('Usuarios exclusivos específicos encontrados:', Object.keys(exclusiveUsers).length);
            Object.keys(exclusiveUsers).forEach(userId => {
              if (allUsers[userId] && exclusiveUsers[userId].exclusive === true) {
                // Solo agregar si no está ya en la lista
                const alreadyExists = vipUsersList.some(user => user.uid === userId);
                if (!alreadyExists) {
                  vipUsersList.push({
                    uid: userId,
                    ...allUsers[userId],
                    vipType: 'exclusive',
                    isExclusive: true,
                    followers: exclusiveUsers[userId].followers || Math.floor(Math.random() * 600) + 200
                  });
                }
              }
            });
          }
        } catch (exclusiveError) {
          console.log('No se encontró nodo exclusive_users específico:', exclusiveError);
        }

        console.log('Total de usuarios VIP encontrados:', vipUsersList.length);

        if (vipUsersList.length === 0) {
          console.log('No se encontraron usuarios VIP');
          vipNoUsers.classList.remove('hidden');
          return;
        }

        // Ordenar usuarios: exclusivos primero, luego VIP, luego colaboradores
        vipUsersList.sort((a, b) => {
          const order = { 'exclusive': 0, 'vip': 1, 'collaborator': 2 };
          return order[a.vipType] - order[b.vipType];
        });

        // Renderizar usuarios VIP
        console.log('Renderizando usuarios VIP...');
        vipUsersList.forEach(user => {
          const userCard = createVipUserCard(user);
          vipContainer.appendChild(userCard);
        });

        console.log('Usuarios VIP cargados exitosamente');

      } catch (error) {
        console.error('Error cargando usuarios VIP:', error);
        vipLoading.classList.add('hidden');
        vipNoUsers.classList.remove('hidden');
      }
    }

    // Crear tarjeta de usuario VIP
    function createVipUserCard(user) {
      const userCard = document.createElement('div');
      userCard.className = 'vip-user-card';
      userCard.setAttribute('data-user-id', user.uid);

      // Obtener avatar del usuario
      let avatarContent = '';
      if (user.profile && user.profile.avatar) {
        const avatarData = user.profile.avatar.data;
        if (avatarData.type === 'icon') {
          avatarContent = `<i class="fas ${avatarData.icon}" style="font-size: 24px; color: white;"></i>`;
        } else if (avatarData.type === 'image') {
          avatarContent = `<img src="${avatarData.url}" alt="${user.name}">`;
        }
      } else {
        // Avatar por defecto
        const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : 'U';
        avatarContent = `<span style="font-size: 20px; font-weight: bold;">${firstLetter}</span>`;
      }

      // Determinar tipo de verificación e insignia según el tipo de usuario
      let vipIcon, vipLabel, avatarCrown = '';

      if (user.vipType === 'exclusive' || user.isExclusive) {
        vipIcon = '<i class="fas fa-certificate" style="color: #ffd700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);"></i>';
        vipLabel = 'Embajador';
        // Corona dorada encima del avatar para usuarios exclusivos
        avatarCrown = `
          <div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); z-index: 10;">
            <i class="fas fa-crown" style="color: #ffd700; font-size: 20px; text-shadow: 0 0 15px rgba(255, 215, 0, 0.9); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));"></i>
          </div>
        `;
      } else if (user.vipType === 'collaborator') {
        vipIcon = '<i class="fas fa-star" style="color: #ffd700;"></i>';
        vipLabel = 'Colaborador';
      } else {
        vipIcon = '<i class="fas fa-check-circle" style="color: #1d9bf0;"></i>';
        vipLabel = 'VIP';
      }

      // Crear username desde email si no existe
      const username = user.profile?.username || user.email.split('@')[0];

      // Estilo especial para el avatar de usuarios exclusivos
      const avatarStyle = user.vipType === 'exclusive' || user.isExclusive ? 
        'background: linear-gradient(45deg, #ffd700, #ffed4e); border: 3px solid #ffd700; box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);' : 
        'background: linear-gradient(45deg, #1d9bf0, #00c9ff);';

      // Agregar atributo para styling especial
      if (user.vipType === 'exclusive' || user.isExclusive) {
        userCard.setAttribute('data-user-type', 'exclusive');
      }

      userCard.innerHTML = `
        <div class="vip-user-avatar" style="position: relative; ${avatarStyle}">
          ${avatarCrown}
          ${avatarContent}
        </div>
        <div class="vip-user-info">
          <div class="vip-user-name">
            <span>@${username}</span>
            ${vipIcon}
          </div>
          <div class="vip-followers-count" id="followers-${user.uid}">${user.followers.toLocaleString()} seguidores</div>
          <div style="font-size: 12px; color: ${user.vipType === 'exclusive' || user.isExclusive ? '#ffd700' : '#71767b'}; margin-top: 2px; font-weight: ${user.vipType === 'exclusive' || user.isExclusive ? '700' : '400'};">${vipLabel}</div>
        </div>
        <button class="vip-follow-btn" onclick="toggleFollowReal('${user.uid}')">
          <i class="fas fa-user-plus"></i>
          Seguir
        </button>
      `;

      return userCard;
    }

    // Sistema de seguimiento para usuarios reales
    async function toggleFollowReal(userId) {
      const button = document.querySelector(`[data-user-id="${userId}"] .vip-follow-btn`);
      const followersElement = document.getElementById(`followers-${userId}`);

      if (!button || !followersElement || !currentFirebaseUser) return;

      try {
        const followStateRef = database.ref(`vip_users/${userId}/followers_list/${currentFirebaseUser.uid}`);
        const followersCountRef = database.ref(`vip_users/${userId}/followers`);
        
        // Verificar estado actual
        const snapshot = await followStateRef.once('value');
        const isFollowing = snapshot.exists();

        if (!isFollowing) {
          // Seguir usuario
          await followStateRef.set({
            followedAt: firebase.database.ServerValue.TIMESTAMP,
            followerName: currentFirebaseUser.displayName || currentFirebaseUser.email
          });

          // Incrementar contador
          await followersCountRef.transaction(currentCount => (currentCount || 0) + 1);

          button.classList.add('following');
          button.innerHTML = '<i class="fas fa-user-check"></i> Siguiendo';

          showFollowFeedback(button, true);
        } else {
          // Dejar de seguir
          await followStateRef.remove();

          // Decrementar contador
          await followersCountRef.transaction(currentCount => Math.max(0, (currentCount || 1) - 1));

          button.classList.remove('following');
          button.innerHTML = '<i class="fas fa-user-plus"></i> Seguir';

          showFollowFeedback(button, false);
        }

        // Actualizar contador en tiempo real
        const newCountSnapshot = await followersCountRef.once('value');
        const newCount = newCountSnapshot.val() || 0;
        followersElement.textContent = `${newCount.toLocaleString()} seguidores`;

      } catch (error) {
        console.error('Error al seguir/dejar de seguir usuario:', error);
        showFollowFeedback(button, null, 'Error al procesar la acción');
      }
    }

    // Función para marcar usuario como VIP (solo para admins)
    async function markUserAsVip(userEmail, isVip = true) {
      if (!currentFirebaseUser) return;

      try {
        // Buscar usuario por email
        const usersRef = database.ref('users');
        const snapshot = await usersRef.orderByChild('email').equalTo(userEmail).once('value');
        const users = snapshot.val();

        if (!users) {
          console.error('Usuario no encontrado:', userEmail);
          return;
        }

        const userId = Object.keys(users)[0];
        const vipRef = database.ref(`vip_users/${userId}`);

        if (isVip) {
          await vipRef.set({
            isVip: true,
            markedAt: firebase.database.ServerValue.TIMESTAMP,
            markedBy: currentFirebaseUser.uid,
            followers: 0
          });
        } else {
          await vipRef.remove();
        }

        console.log(`Usuario ${userEmail} ${isVip ? 'marcado como VIP' : 'removido de VIP'}`);
      } catch (error) {
        console.error('Error marcando usuario como VIP:', error);
      }
    }

    // Función para marcar usuario como exclusivo (solo para admins)
    async function markUserAsExclusive(userEmail, isExclusive = true) {
      if (!currentFirebaseUser) return;

      try {
        // Buscar usuario por email
        const usersRef = database.ref('users');
        const snapshot = await usersRef.orderByChild('email').equalTo(userEmail).once('value');
        const users = snapshot.val();

        if (!users) {
          console.error('Usuario no encontrado:', userEmail);
          return;
        }

        const userId = Object.keys(users)[0];
        
        if (isExclusive) {
          // Marcar como exclusivo en el nodo del usuario
          await database.ref(`users/${userId}/exclusive`).set(true);
          
          // También crear entrada en nodo exclusive_users para seguimiento
          await database.ref(`exclusive_users/${userId}`).set({
            exclusive: true,
            markedAt: firebase.database.ServerValue.TIMESTAMP,
            markedBy: currentFirebaseUser.uid,
            followers: 0
          });
        } else {
          // Remover estado exclusivo
          await database.ref(`users/${userId}/exclusive`).remove();
          await database.ref(`exclusive_users/${userId}`).remove();
        }

        console.log(`Usuario ${userEmail} ${isExclusive ? 'marcado como EXCLUSIVO' : 'removido de EXCLUSIVO'}`);
        
        // Recargar la sección VIP para mostrar los cambios
        if (document.getElementById('vipSection').classList.contains('active')) {
          loadVipUsers();
        }
        
      } catch (error) {
        console.error('Error marcando usuario como exclusivo:', error);
      }
    }

    // Función de debugging para verificar usuarios exclusivos
    async function debugExclusiveUsers() {
      try {
        console.log('=== DEBUG: Verificando usuarios exclusivos ===');
        
        // Verificar usuarios en el nodo principal
        const usersRef = database.ref('users');
        const usersSnapshot = await usersRef.once('value');
        const allUsers = usersSnapshot.val();
        
        if (allUsers) {
          console.log('Total de usuarios registrados:', Object.keys(allUsers).length);
          
          Object.keys(allUsers).forEach(userId => {
            const user = allUsers[userId];
            if (user.exclusive === true) {
              console.log('Usuario exclusivo encontrado en nodo users:', {
                email: user.email,
                name: user.name,
                exclusive: user.exclusive,
                uid: userId
              });
            }
          });
        }
        
        // Verificar nodo exclusive_users
        const exclusiveRef = database.ref('exclusive_users');
        const exclusiveSnapshot = await exclusiveRef.once('value');
        const exclusiveUsers = exclusiveSnapshot.val();
        
        if (exclusiveUsers) {
          console.log('Usuarios en nodo exclusive_users:', Object.keys(exclusiveUsers).length);
          Object.keys(exclusiveUsers).forEach(userId => {
            console.log('Usuario en exclusive_users:', {
              userId: userId,
              data: exclusiveUsers[userId],
              userEmail: allUsers && allUsers[userId] ? allUsers[userId].email : 'Usuario no encontrado'
            });
          });
        } else {
          console.log('No hay usuarios en el nodo exclusive_users');
        }
        
        console.log('=== FIN DEBUG ===');
        
      } catch (error) {
        console.error('Error en debug:', error);
      }
    }

    // Función para dar acceso de colaborador gratuito
    async function grantCollaboratorAccess(userEmail) {
      if (!currentFirebaseUser) return;

      try {
        // Buscar usuario por email
        const usersRef = database.ref('users');
        const snapshot = await usersRef.orderByChild('email').equalTo(userEmail).once('value');
        const users = snapshot.val();

        if (!users) {
          console.error('Usuario no encontrado:', userEmail);
          return;
        }

        const userId = Object.keys(users)[0];
        const userRef = database.ref(`users/${userId}/subscription`);

        await userRef.set({
          type: 'collaborator',
          status: 'active',
          grantedAt: firebase.database.ServerValue.TIMESTAMP,
          grantedBy: currentFirebaseUser.uid,
          plan: 'free_collaborator'
        });

        // También agregar a VIP
        const vipRef = database.ref(`vip_users/${userId}`);
        await vipRef.set({
          isVip: true,
          isCollaborator: true,
          markedAt: firebase.database.ServerValue.TIMESTAMP,
          markedBy: currentFirebaseUser.uid,
          followers: 0
        });

        console.log(`Acceso de colaborador otorgado a ${userEmail}`);
      } catch (error) {
        console.error('Error otorgando acceso de colaborador:', error);
      }
    }

    // Función para seguir/dejar de seguir usuarios VIP
    function toggleFollow(userId) {
      const button = document.querySelector(`[data-user-id="${userId}"] .vip-follow-btn`);
      const followersElement = document.getElementById(`followers-${userId}`);

      if (!button || !followersElement) return;

      const followState = JSON.parse(localStorage.getItem('vip_follow_state') || '{}');
      const isFollowing = followState[userId] || false;

      // Obtener número actual de seguidores
      const currentText = followersElement.textContent;
      let currentCount = parseInt(currentText.replace(/[^\d]/g, ''));

      if (!isFollowing) {
        // Seguir
        followState[userId] = true;
        button.classList.add('following');
        button.innerHTML = '<i class="fas fa-user-check"></i> Siguiendo';
        currentCount++;
      } else {
        // Dejar de seguir
        followState[userId] = false;
        button.classList.remove('following');
        button.innerHTML = '<i class="fas fa-user-plus"></i> Seguir';
        currentCount--;
      }

      // Actualizar contador en tiempo real
      followersElement.textContent = `${currentCount.toLocaleString()} seguidores`;

      // Guardar estado
      localStorage.setItem('vip_follow_state', JSON.stringify(followState));

      // Mostrar feedback visual
      showFollowFeedback(button, !isFollowing);
    }

    // Mostrar feedback de seguimiento
    function showFollowFeedback(button, isFollowing) {
      const feedback = document.createElement('div');
      feedback.textContent = isFollowing ? '¡Siguiendo!' : 'Dejaste de seguir';
      feedback.style.cssText = `
        position: absolute;
        top: -40px;
        left: 50%;
        transform: translateX(-50%);
        background: ${isFollowing ? '#10b981' : '#6b7280'};
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        z-index: 1000;
        pointer-events: none;
        opacity: 0;
        animation: feedbackPop 2s ease-out;
      `;

      button.style.position = 'relative';
      button.appendChild(feedback);

      setTimeout(() => {
        if (feedback.parentNode) {
          feedback.parentNode.removeChild(feedback);
        }
      }, 2000);
    }

    // Cargar configuraciones actuales
    function loadCurrentSettings() {
      // Cargar perfil del usuario
      if (userProfile) {
        document.getElementById('currentProfileName').textContent = userProfile.name || 'Usuario';
      }

      // Cargar configuraciones guardadas
      const settings = JSON.parse(localStorage.getItem('ibtv_settings') || '{}');

      document.getElementById('autoplayToggle').checked = settings.autoplay !== false;
      document.getElementById('videoQuality').value = settings.videoQuality || 'auto';
      document.getElementById('interfaceLanguage').value = settings.language || 'es';
      document.getElementById('preferredAudio').value = settings.preferredAudio || 'original';
      document.getElementById('defaultSubtitles').checked = settings.defaultSubtitles || false;
      document.getElementById('releaseNotifications').checked = settings.releaseNotifications !== false;
      document.getElementById('reminderNotifications').checked = settings.reminderNotifications !== false;
      document.getElementById('parentalControl').value = settings.parentalControl || 'all';
    }

    // Guardar ajustes
    function saveSettings() {
      const settings = {
        autoplay: document.getElementById('autoplayToggle').checked,
        videoQuality: document.getElementById('videoQuality').value,
        language: document.getElementById('interfaceLanguage').value,
        preferredAudio: document.getElementById('preferredAudio').value,
        defaultSubtitles: document.getElementById('defaultSubtitles').checked,
        releaseNotifications: document.getElementById('releaseNotifications').checked,
        reminderNotifications: document.getElementById('reminderNotifications').checked,
        parentalControl: document.getElementById('parentalControl').value
      };

      localStorage.setItem('ibtv_settings', JSON.stringify(settings));
      showSettingsMessage('Configuración guardada correctamente');
    }

    // Restablecer ajustes
    function resetSettings() {
      localStorage.removeItem('ibtv_settings');
      loadCurrentSettings();
      showSettingsMessage('Configuración restablecida a valores predeterminados');
    }

    // Mostrar mensaje de ajustes
    function showSettingsMessage(message) {
      const messageEl = document.createElement('div');
      messageEl.style.cssText = `
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(29, 155, 240, 0.9);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        z-index: 5000;
        backdrop-filter: blur(12px);
      `;
      messageEl.textContent = message;

      document.body.appendChild(messageEl);

      setTimeout(() => {
        if (messageEl.parentNode) {
          messageEl.parentNode.removeChild(messageEl);
        }
      }, 3000);
    }

    // Manejar cambio de idioma
    function handleLanguageChange(language) {
      localStorage.setItem('ibtv_language', language);
      showSettingsMessage('Idioma cambiado. Recarga la página para ver los cambios.');
    }

    // Inicializar el sistema cuando se carga la página
    document.addEventListener('DOMContentLoaded', async function() {
      const authenticated = await checkAuthentication();
      if (authenticated) {
        initializePremiereSystem();
        // Ejecutar debug de usuarios exclusivos
        setTimeout(() => {
          debugExclusiveUsers();
        }, 2000);
      }
    });
  </script>

  <script>
    // Sistema de traducción
    let currentLanguage = localStorage.getItem('ibtv_language') || 'es';
    let translations = {};
    let isTranslating = false;

    // Textos de la interfaz para traducir
    const interfaceTexts = {
      // Navegación
      'Inicio': 'Home',
      'Buscar': 'Search',
      'Ajustes': 'Settings',

      // Búsqueda
      'Buscar series y películas': 'Search series and movies',
      'Buscando contenido...': 'Searching content...',
      'Resultados de búsqueda': 'Search results',
      'No se encontraron resultados': 'No results found',
      'Intenta con otros términos de búsqueda': 'Try different search terms',
      'resultado': 'result',
      'resultados': 'results',
      'encontrados': 'found',

      // Contenido
      'Películas': 'Movies',
      'Tendencias': 'Trending',
      'Terror': 'Horror',
      'Anime': 'Anime',
      'Película': 'Movie',
      'Episodios': 'Episodes',
      'Temporada': 'Season',
      'Trailer Oficial': 'Official Trailer',
      'Reproducir': 'Play',
      'Ver Trailer': 'Watch Trailer',
      'Más Info': 'More Info',
      'Próximamente': 'Coming Soon',
      'Ver Película': 'Watch Movie',
      'Estreno': 'Premiere',
      'EN VIVO': 'LIVE',
      'DISPONIBLE': 'AVAILABLE',
      'VISTO': 'WATCHED',

      // Ajustes
      'Configuración': 'Settings',
      'Personaliza tu experiencia de visualización': 'Customize your viewing experience',
      'Reproducción': 'Playback',
      'Reproducción automática': 'Auto-play',
      'Reproducir automáticamente el siguiente episodio': 'Automatically play next episode',
      'Calidad de video': 'Video quality',
      'Seleccionar calidad predeterminada': 'Select default quality',
      'Automática': 'Auto',
      'Idioma y Audio': 'Language & Audio',
      'Idioma de la interfaz': 'Interface language',
      'Cambiar idioma de la aplicación': 'Change app language',
      'Audio preferido': 'Preferred audio',
      'Idioma de audio predeterminado': 'Default audio language',
      'Audio original': 'Original audio',
      'Subtítulos': 'Subtitles',
      'Mostrar subtítulos por defecto': 'Show subtitles by default',
      'Notificaciones': 'Notifications',
      'Nuevos estrenos': 'New releases',
      'Notificar sobre nuevas películas y series': 'Notify about new movies and series',
      'Recordatorios': 'Reminders',
      'Recordar contenido pausado': 'Remember paused content',
      'Control Parental': 'Parental Control',
      'Contenido para menores': 'Content for minors',
      'Filtrar contenido por clasificación': 'Filter content by rating',
      'Todo el contenido': 'All content',
      'Solo contenido familiar': 'Family content only',
      'Restablecer': 'Reset',
      'Guardar Cambios': 'Save Changes',
      'Configuración guardada correctamente': 'Settings saved successfully',
      'Configuración restablecida a valores predeterminados': 'Settings reset to defaults',

      // Video player
      'Reproduciendo...': 'Playing...',
      'Audio': 'Audio',
      'No hay pistas de audio alternativas disponibles': 'No alternative audio tracks available',
      'No hay subtítulos disponibles para este contenido': 'No subtitles available for this content',
      'Subtítulos desactivados': 'Subtitles disabled',
      'Error al cargar el video. Verifica tu conexión e intenta de nuevo.': 'Error loading video. Check your connection and try again.',
      'Trailer no disponible': 'Trailer not available',
      'Error al cargar el trailer': 'Error loading trailer',

      // Mensajes especiales
      'ESTRENO MUNDIAL': 'WORLD PREMIERE',
      'Transmisión simultánea mundial - Una sola vez': 'Worldwide simultaneous broadcast - One time only',
      'ATENCIÓN: Esta es tu única oportunidad de ver esta transmisión. Una vez que termine, no podrás verla nuevamente hasta el 13 de junio.': 'ATTENTION: This is your only chance to watch this broadcast. Once it ends, you won\'t be able to watch it again until June 13th.',
      'Esta transmisión EN VIVO ya fue vista y no puede reproducirse nuevamente. Era una experiencia única e irrepetible.': 'This LIVE broadcast has already been watched and cannot be played again. It was a unique and unrepeatable experience.',
      'Una transmisión única que no te puedes perder.': 'A unique broadcast you can\'t miss.',
      'Transmisión Finalizada': 'Broadcast Ended',
      'Ver Transmisión EN VIVO': 'Watch LIVE Broadcast',

      // Fechas y tiempo
      'DÍAS': 'DAYS',
      'HRS': 'HRS',
      'MIN': 'MIN',
      'SEG': 'SEC',
      'Junio': 'June',
      'lunes': 'Monday',
      'martes': 'Tuesday',
      'miércoles': 'Wednesday',
      'jueves': 'Thursday',
      'viernes': 'Friday',
      'sábado': 'Saturday',
      'domingo': 'Sunday'
    };

    // Base de datos de series y episodios
    const seriesDatabase = {

      notemuevas: {
        id: 'notemuevas',
        title: "NO TE MUEVAS",
        year: '2025',
        genre: 'Terror, Thriller, Suspenso',
        rating: '18+',
        type: 'movie',
        isLocked: false,
        isLive: false,
        hasCountdown: false,
        description: 'Una terrorífica película de suspense que te mantendrá inmóvil del terror. Cuando te dicen "no te muevas", más vale que obedezcas.',
        poster: 'https://i.ibb.co/DDh79krZ/image.png',
        trailer: 'https://dl.dropboxusercontent.com/scl/fi/h5ekhsy1045o93jdnp6ff/copy_426DEAF5-2226-49A9-9851-729E4CF8A1AB.mov?rlkey=ar8anbypid3bm3fxosbet22fb&st=embhl2dy&dl=1',
        youtubeReference: '#',
        subtitles: {
          spanish: {
            type: 'inline',
            cues: [
              { start: '00:03:09.000', end: '00:03:10.000', text: '¿Qué me pasó?' },
              { start: '00:04:11.000', end: '00:04:12.500', text: '<v.sound-effect>{risas}</v.sound-effect>' },
              { start: '00:04:12.500', end: '00:04:14.000', text: 'Eres un insípido niño' }
            ]
          },
          english: {
            type: 'inline',
            cues: [
              { start: '00:03:09.000', end: '00:03:10.000', text: 'What happened to me?' },
              { start: '00:04:11.000', end: '00:04:12.500', text: '<v.sound-effect>{laughter}</v.sound-effect>' },
              { start: '00:04:12.500', end: '00:04:14.000', text: 'You are an insipid child' }
            ]
          },
          portuguese: {
            type: 'inline',
            cues: [
              { start: '00:03:09.000', end: '00:03:10.000', text: 'O que aconteceu comigo?' },
              { start: '00:04:11.000', end: '00:04:12.500', text: '<v.sound-effect>{risos}</v.sound-effect>' },
              { start: '00:04:12.500', end: '00:04:14.000', text: 'Você é uma criança insípida' }
            ]
          }
        },
        episodes: [
          {
            id: 1,
            title: "NO TE MUEVAS",
            description: 'Una terrorífica película de suspense que te mantendrá inmóvil del terror.',
            duration: null,
            thumbnail: 'https://i.ibb.co/DDh79krZ/image.png',
            videoUrl: 'https://dl.dropboxusercontent.com/scl/fi/h5ekhsy1045o93jdnp6ff/copy_426DEAF5-2226-49A9-9851-729E4CF8A1AB.mov?rlkey=ar8anbypid3bm3fxosbet22fb&st=embhl2dy&dl=1'
          }
        ]
      },

      doublevision: {
        id: 'doublevision',
        title: "DOUBLE VISION",
        year: '2025',
        genre: 'Terror, Thriller, Suspenso',
        rating: '18+',
        type: 'movie',
        isLocked: false,
        isLive: false,
        hasCountdown: false,
        description: 'Una escalofriante película de terror que te hará cuestionar lo que es real y lo que es pesadilla. Cuando la realidad se duplica, el horror se multiplica.',
        poster: 'https://m.media-amazon.com/images/M/MV5BODZiOGIxZTQtZjA2My00NzY3LTlkZTktZmFlZjJkOThhN2NjXkEyXkFqcGc@._V1_QL75_UX190_CR0,2,190,281_.jpg',
        trailer: 'https://dl.dropboxusercontent.com/scl/fi/knmd1rvklx9qkmzz38d5x/2968597981486262751.mp4?rlkey=hpz7w3qyd67yboabi09svgl64&st=2h4ym2d1',
        youtubeReference: '#',
        subtitles: {
          spanish: 'subtitles/double-vision-es.vtt',
          english: 'subtitles/double-vision-en.vtt'
        },
        episodes: [
          {
            id: 1,
            title: "DOUBLE VISION",
            description: 'Una escalofriante película de terror que te hará cuestionar lo que es real y lo que es pesadilla.',
            duration: null,
            thumbnail: 'https://m.media-amazon.com/images/M/MV5BODZiOGIxZTQtZjA2My00NzY3LTlkZTktZmFlZjJkOThhN2NjXkEyXkFqcGc@._V1_QL75_UX190_CR0,2,190,281_.jpg',
            videoUrl: 'https://dl.dropboxusercontent.com/scl/fi/knmd1rvklx9qkmzz38d5x/2968597981486262751.mp4?rlkey=hpz7w3qyd67yboabi09svgl64&st=2h4ym2d1'
          }
        ]
      },

      dontlookaway: {
        id: 'dontlookaway',
        title: "DON'T LOOK AWAY",
        year: '2025',
        genre: 'Terror, Thriller, Suspenso',
        rating: '18+',
        type: 'movie', // Detector de tipo
        description: 'Una película de terror psicológico que te mantendrá al borde del asiento. La historia sigue a un grupo de personas que se enfrentan a una amenaza sobrenatural que los obliga a no apartar la mirada.',
        poster: 'https://i.ytimg.com/vi/4f3hG-5grlw/maxresdefault.jpg',
        trailer: 'https://dl.dropboxusercontent.com/scl/fi/1kpsf3351raocgyiwb1rd/3984583787530253122.mp4?rlkey=ac3xzejk67taj2odw9q94rc07&st=y2152ek3',
        youtubeReference: 'https://youtu.be/4f3hG-5grlw?si=adowKM2_Y8GX4G99',
        audioTracks: {
          original: 'https://dl.dropboxusercontent.com/scl/fi/1kpsf3351raocgyiwb1rd/3984583787530253122.mp4?rlkey=ac3xzejk67taj2odw9q94rc07&st=y2152ek3',
          spanish: 'https://dl.dropboxusercontent.com/scl/fi/1kpsf3351raocgyiwb1rd/3984583787530253122.mp4?rlkey=ac3xzejk67taj2odw9q94rc07&st=y2152ek3',
          english: 'https://dl.dropboxusercontent.com/scl/fi/1kpsf3351raocgyiwb1rd/3984583787530253122.mp4?rlkey=ac3xzejk67taj2odw9q94rc07&st=y2152ek3'
        },
        currentAudioTrack: 'original',
        subtitles: {
          spanish: 'subtitles/dont-look-away-es.vtt',
          english: 'subtitles/dont-look-away-en.vtt'
        },
        episodes: [
          {
            id: 1,
            title: "DON'T LOOK AWAY",
            description: 'Una aterradora experiencia cinematográfica que desafía los límites del horror psicológico.',
            duration: null,
            thumbnail: 'https://i.ytimg.com/vi/4f3hG-5grlw/maxresdefault.jpg',
            videoUrl: 'https://dl.dropboxusercontent.com/scl/fi/1kpsf3351raocgyiwb1rd/3984583787530253122.mp4?rlkey=ac3xzejk67taj2odw9q94rc07&st=y2152ek3'
          }
        ]
      },
      thecandleman: {
        id: 'thecandleman',
        title: "THE CANDLE MAN",
        year: '2024',
        genre: 'Terror, Cortometraje',
        rating: '18+',
        type: 'shortfilm', // Usar 'shortfilm' para cortometraje
        description: 'En la oscuridad total de un apagón, un hombre enciende velas para iluminar su hogar. Sin embargo, cada vela que apaga despierta la ira de un demonio infernal que odia la extinción de las llamas. En un escalofriante clímax, el hombre descubre que algunas tinieblas no pueden ser vencidas por la luz.',
        poster: 'https://i.ytimg.com/vi/i229gWn3Z5A/maxresdefault.jpg',
        trailer: 'https://www.dropbox.com/scl/fi/5ktcz9zq60w5hq2s2arde/602596538962659684.mp4?rlkey=q35ez2mg7lu30xx31s5vahxso&st=r1c3005h&dl=0', // Dropbox link converted to direct streaming
        youtubeReference: '#',
        subtitles: {}, // No subtitles provided for this short film
        episodes: [
          {
            id: 1,
            title: "THE CANDLE MAN",
            description: 'Un hombre enciende velas para alejar la oscuridad, sin saber que cada vela apagada enfurece a un demonio.',
            duration: null,
            thumbnail: 'https://i.ytimg.com/vi/i229gWn3Z5A/maxresdefault.jpg',
            videoUrl: 'https://www.dropbox.com/scl/fi/5ktcz9zq60w5hq2s2arde/602596538962659684.mp4?rlkey=q35ez2mg7lu30xx31s5vahxso&st=r1c3005h&dl=0' // Dropbox link converted to direct streaming
          }
        ]
      },


    };

    // Variables globales
    let currentSeries = null;
    let currentVideo = null;
    let progressUpdateInterval = null;

    // Sistema de calificaciones
    let currentRatings = {};
    let userRatings = JSON.parse(localStorage.getItem('ibtv_ratings') || '{}');

    // Función para calificar contenido
    function rateContent(rating) {
      if (!currentSeries) return;

      const seriesId = currentSeries.id;
      const previousRating = userRatings[seriesId];

      // Si ya calificó lo mismo, no hacer nada
      if (previousRating === rating) {
        showRatingFeedback('Ya has calificado este contenido');
        return;
      }

      // Actualizar calificación del usuario
      userRatings[seriesId] = rating;
      localStorage.setItem('ibtv_ratings', JSON.stringify(userRatings));

      // Actualizar datos de calificaciones
      if (!currentRatings[seriesId]) {
        currentRatings[seriesId] = { good: 0, bad: 0 };
      }

      // Si cambió de calificación, restar la anterior
      if (previousRating) {
        currentRatings[seriesId][previousRating]--;
      }

      // Agregar nueva calificación
      currentRatings[seriesId][rating]++;

      // Guardar en localStorage
      localStorage.setItem('ibtv_series_ratings', JSON.stringify(currentRatings));

      // Actualizar UI
      updateRatingDisplay(seriesId);
      showRatingFeedback(rating === 'good' ? '¡Gracias! Te gustó el contenido' : 'Gracias por tu feedback');
    }

    // Función para mostrar feedback de calificación
    function showRatingFeedback(message) {
      const ratingSection = document.getElementById('ratingSection');

      // Remover feedback anterior si existe
      const existingFeedback = ratingSection.querySelector('.rating-feedback');
      if (existingFeedback) {
        existingFeedback.remove();
      }

      const feedback = document.createElement('div');
      feedback.className = 'rating-feedback';
      feedback.textContent = message;
      ratingSection.style.position = 'relative';
      ratingSection.appendChild(feedback);

      // Remover después de la animación
      setTimeout(() => {
        if (feedback.parentNode) {
          feedback.parentNode.removeChild(feedback);
        }
      }, 2000);
    }

    // Función para actualizar display de calificaciones
    function updateRatingDisplay(seriesId) {
      const ratings = currentRatings[seriesId] || { good: 0, bad: 0 };
      const total = ratings.good + ratings.bad;
      const userRating = userRatings[seriesId];

      // Actualizar contadores
      document.getElementById('goodCount').textContent = ratings.good;
      document.getElementById('badCount').textContent = ratings.bad;

      // Actualizar botones activos
      const goodBtn = document.getElementById('goodBtn');
      const badBtn = document.getElementById('badBtn');

      goodBtn.classList.toggle('active', userRating === 'good');
      badBtn.classList.toggle('active', userRating === 'bad');

      // Actualizar barras de progreso
      if (total > 0) {
        const goodPercentage = Math.round((ratings.good / total) * 100);
        const badPercentage = Math.round((ratings.bad / total) * 100);

        document.getElementById('goodProgress').style.width = `${goodPercentage}%`;
        document.getElementById('badProgress').style.width = `${badPercentage}%`;
        document.getElementById('goodPercentage').textContent = `${goodPercentage}%`;
        document.getElementById('badPercentage').textContent = `${badPercentage}%`;
      } else {
        document.getElementById('goodProgress').style.width = '0%';
        document.getElementById('badProgress').style.width = '0%';
        document.getElementById('goodPercentage').textContent = '0%';
        document.getElementById('badPercentage').textContent = '0%';
      }
    }

    // Función para cargar calificaciones guardadas
    function loadRatings() {
      const savedRatings = localStorage.getItem('ibtv_series_ratings');
      if (savedRatings) {
        currentRatings = JSON.parse(savedRatings);
      }

      // Agregar algunas calificaciones de ejemplo si no hay datos
      if (Object.keys(currentRatings).length === 0) {
        currentRatings = {
          'dontlookaway': { good: 247, bad: 18 },
          'notemuevas': { good: 156, bad: 32 },
          'doublevision': { good: 89, bad: 45 }
        };
        localStorage.setItem('ibtv_series_ratings', JSON.stringify(currentRatings));
      }
    }

    // Función para crear fecha de estreno para el 11 de junio a las 2:40 AM Houston
    function createJuneReleaseDate() {
      const now = new Date();
      const currentYear = now.getFullYear();

      // Crear fecha para el 11 de junio del año actual a las 2:40 AM Houston (UTC-6)
      // 2:40 AM Houston = 8:40 AM UTC
      const releaseDate = new Date();
      releaseDate.setUTCFullYear(currentYear, 5, 11); // Junio = mes 5 (0-indexado)
      releaseDate.setUTCHours(8, 40, 0, 0); // 8:40 UTC = 2:40 AM Houston

      // Si ya pasó el 11 de junio de este año, programar para el próximo año
      if (now > releaseDate) {
        releaseDate.setUTCFullYear(currentYear + 1);
      }

      return releaseDate;
    }

    // Función para crear fecha de disponibilidad permanente (13 de junio)
    function createPermanentAvailabilityDate() {
      const now = new Date();
      const currentYear = now.getFullYear();

      // Crear fecha para el 13 de junio del año actual (2 días después del estreno)
      const availabilityDate = new Date();
      availabilityDate.setUTCFullYear(currentYear, 5, 13); // Junio = mes 5 (0-indexado)
      availabilityDate.setUTCHours(0, 0, 0, 0); // Medianoche UTC

      // Si ya pasó el 13 de junio de este año, programar para el próximo año
      if (now > availabilityDate) {
        availabilityDate.setUTCFullYear(currentYear + 1);
      }

      return availabilityDate;
    }

    // Función para verificar si una película ha sido vista
    function hasMovieBeenWatched(movieId) {
      return localStorage.getItem(`watched_${movieId}`) === 'true';
    }

    // Función para marcar película como vista
    function markMovieAsWatched(movieId) {
      localStorage.setItem(`watched_${movieId}`, 'true');
    }

    // Función para verificar si una película está disponible
    function isMovieAvailable(series) {
      // NO TE MUEVAS ahora está completamente desbloqueada
      if (series.id === 'notemuevas') {
        return true; // Siempre disponible
      }

      // Otras películas funcionan normally
      if (!series.releaseDate) return true;

      const now = new Date();
      const releaseDate = new Date(series.releaseDate);
      return now >= releaseDate;
    }

    // Función para verificar si una película está en vivo
    function isMovieLive(series) {
      if (!series.releaseDate) return false;

      const now = new Date();
      const releaseDate = new Date(series.releaseDate);
      const timeDiff = Math.abs(now.getTime() - releaseDate.getTime());

      // Considerar "en vivo" durante los primeros 60 minutos después del estreno
      return now >= releaseDate && timeDiff <= (60 * 60 * 1000);
    }

    // Función para actualizar indicadores de estreno
    function updateReleaseIndicators() {
      Object.values(seriesDatabase).forEach(series => {
        if (series.releaseDate) {
          const badgeElement = document.getElementById(`${series.id}-badge`);

          if (series.id === 'notemuevas') {
            // Manejo especial para NO TE MUEVAS con cuenta regresiva
            updateCountdownToJune();
          } else if (badgeElement) {
            // Manejo estándar para otras películas
            const lockElement = document.getElementById(`${series.id}-lock`);

            if (lockElement) {
              if (isMovieAvailable(series)) {
                lockElement.style.display = 'none';

                if (isMovieLive(series)) {
                  badgeElement.className = 'live-badge';
                  badgeElement.textContent = 'EN VIVO';
                } else {
                  badgeElement.className = 'movie-badge';
                  badgeElement.textContent = 'Película';
                }
              } else {
                lockElement.style.display = 'flex';
                badgeElement.className = 'premiere-badge';
                badgeElement.textContent = 'Estreno';
              }
            }
          }
        }
      });
    }

    // Elementos del DOM
    const videoPlayer = document.getElementById('videoPlayer');
    const videoElement = document.getElementById('videoElement');
    const videoPlayerTitle = document.getElementById('videoPlayerTitle');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const pauseIndicator = document.getElementById('pauseIndicator');
    const videoProgressFill = document.getElementById('videoProgressFill');
    const currentTimeElement = document.getElementById('currentTime');
    const durationElement = document.getElementById('duration');
    const volumeBtn = document.getElementById('volumeBtn');

    // Función para mostrar detalles de serie estilo Netflix
    function showSeriesDetail(seriesId) {
      const series = seriesDatabase[seriesId];
      if (!series) return;

      currentSeries = series;

      // Actualizar contenido
      document.getElementById('seriesDetailTitle').textContent = series.title;
      document.getElementById('seriesDetailDescription').textContent = series.description;

      // Configurar imagen de fondo
      const backgroundEl = document.getElementById('seriesDetailBackground');
      backgroundEl.style.backgroundImage = `url('${series.poster}')`;

      // Configurar video de trailer si está disponible
      setupNetflixTrailer(series);

      // Actualizar metadatos según el tipo
      const metaElement = document.getElementById('seriesDetailMeta');
      if (series.type === 'movie' || series.type === 'shortfilm') {
        metaElement.innerHTML = `
          <span>${series.year}</span>
          <span>${series.type === 'movie' ? 'Película' : 'Cortometraje'}</span>
          <span>${series.genre.split(',')[0]}</span>
          <span>${series.rating}</span>
        `;
      } else {
        const episodeCount = series.episodes ? series.episodes.length : 0;
        metaElement.innerHTML = `
          <span>${series.year}</span>
          <span>${episodeCount} episodios</span>
          <span>${series.genre.split(',')[0]}</span>
          <span>${series.rating}</span>
        `;
      }

      // Cargar episodios o película
      loadContent(series);

      // Actualizar botón de reproducir según disponibilidad
      updateNetflixPlayButton(series);

      // Mostrar cuenta regresiva en detalles si es necesario
      showCountdownInDetails(series);

      // Mostrar vista detallada
      document.getElementById('seriesDetail').classList.add('active');

      // Cargar y mostrar calificaciones
      updateRatingDisplay(seriesId);
    }

    // Función para configurar el trailer estilo Netflix
    function setupNetflixTrailer(series) {
      const videoEl = document.getElementById('seriesDetailVideo');
      const playBtn = document.getElementById('netflixPlayBtn');
      const soundBtn = document.getElementById('soundToggle');

      // Limpiar estado anterior
      videoEl.classList.remove('loaded');
      playBtn.classList.remove('loading');
      playBtn.style.display = 'flex';

      if (!series.trailer) {
        videoEl.style.display = 'none';
        soundBtn.style.display = 'none';
        return;
      }

      // Mostrar loading inmediatamente
      playBtn.classList.add('loading');
      soundBtn.style.display = 'none';

      // Configurar video con atributos correctos para evitar difuminado
      videoEl.style.display = 'block';
      videoEl.style.opacity = '0';
      videoEl.muted = true;
      videoEl.loop = true;
      videoEl.playsInline = true;
      videoEl.setAttribute('playsinline', 'true');
      videoEl.setAttribute('webkit-playsinline', 'true');
      videoEl.setAttribute('x5-playsinline', 'true');

      // Event listener para cuando el video esté listo
      const onLoadedData = () => {
        setTimeout(() => {
          videoEl.style.opacity = '1';
          videoEl.classList.add('loaded');
          playBtn.style.display = 'none'; // Ocultar botón de play cuando el video carga
          soundBtn.style.display = 'flex';

          // Auto-reproducir el trailer
          const playPromise = videoEl.play();
          if (playPromise !== undefined) {
            playPromise.then(() => {
              console.log('Trailer playing automatically');
            }).catch(e => {
              console.log('Autoplay prevented:', e);
              playBtn.style.display = 'flex'; // Mostrar botón si autoplay falla
            });
          }
        }, 500);

        videoEl.removeEventListener('loadeddata', onLoadedData);
      };

      const onCanPlay = () => {
        playBtn.style.display = 'none'; // Asegurar que se oculte cuando puede reproducir
        videoEl.removeEventListener('canplay', onCanPlay);
      };

      const onError = () => {
        console.log('Error loading trailer, using poster only');
        videoEl.style.display = 'none';
        playBtn.classList.remove('loading');
        playBtn.style.display = 'flex';
        soundBtn.style.display = 'none';
        videoEl.removeEventListener('error', onError);
      };

      // Agregar event listeners
      videoEl.addEventListener('loadeddata', onLoadedData);
      videoEl.addEventListener('canplay', onCanPlay);
      videoEl.addEventListener('error', onError);

      // Configurar source y cargar
      videoEl.src = series.trailer;
      videoEl.load();
    }

    // Función para alternar sonido del trailer
    function toggleTrailerSound() {
      const videoEl = document.getElementById('seriesDetailVideo');
      const soundBtn = document.getElementById('soundToggle');

      if (videoEl.muted) {
        videoEl.muted = false;
        videoEl.volume = 0.3; // Volumen moderado
        soundBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
      } else {
        videoEl.muted = true;
        soundBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
      }
    }

    // Función para reproducir película principal desde el botón Netflix
    function playMainMovie() {
      if (!currentSeries) return;

      // Verificar disponibilidad
      if (currentSeries.isLocked && !isMovieAvailable(currentSeries)) {
        showLockedMessage(currentSeries);
        return;
      }

      // Cerrar detalles y reproducir
      closeSeriesDetail();
      setTimeout(() => {
        playEpisode(1, 1);
      }, 300);
    }

    // Función para actualizar botón de Netflix
    function updateNetflixPlayButton(series) {
      const playBtn = document.getElementById('netflixPlayBtn');
      if (!playBtn) return;

      if (series.isLocked && !isMovieAvailable(series)) {
        playBtn.innerHTML = '<i class="fas fa-lock"></i>';
        playBtn.style.background = 'rgba(128, 128, 128, 0.7)';
        playBtn.style.cursor = 'not-allowed';
        playBtn.onclick = () => showLockedMessage(series);
      } else {
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
        playBtn.style.background = 'rgba(255, 255, 255, 0.9)';
        playBtn.style.cursor = 'pointer';
        playBtn.onclick = playMainMovie;
      }
    }

    // Función para actualizar botón de reproducir
    function updatePlayButton(series) {
      const playButton = document.getElementById('playButton');
      if (!playButton) return;

      if (series.id === 'notemuevas') {
        // NO TE MUEVAS siempre disponible para ver
        playButton.innerHTML = '<i class="fas fa-play"></i> Reproducir';
        playButton.style.background = '#1d9bf0';
        playButton.style.color = '#fff';
        playButton.style.cursor = 'pointer';
        playButton.onclick = () => playEpisode(1, 1);
      } else if (series.isLocked && !isMovieAvailable(series)) {
        // Otras películas bloqueadas
        playButton.innerHTML = '<i class="fas fa-lock"></i> Próximamente';
        playButton.style.background = '#666';
        playButton.style.cursor = 'not-allowed';
        playButton.onclick = () => showLockedMessage(series);
      } else {
        // Otras películas disponibles
        playButton.innerHTML = '<i class="fas fa-play"></i> Reproducir';
        playButton.style.background = '#1d9bf0';
        playButton.style.cursor = 'pointer';
        playButton.onclick = () => playEpisode(1, 1);
      }
    }

    // Funciones del reproductor de video
    function closeVideoPlayer() {
      videoPlayer.classList.remove('active');
      document.body.classList.remove('video-playing');

      if (videoElement) {
        videoElement.pause();
        videoElement.removeAttribute('src');
        videoElement.load();
      }

      if (progressUpdateInterval) {
        clearInterval(progressUpdateInterval);
      }

      currentVideo = null;
      isPlayingIntro = false;
      isScreenLocked = false;
    }

    // Función para alternar reproducción/pausa
    function togglePlayPause() {
      if (!videoElement) return;

      if (videoElement.paused) {
        videoElement.play();
      } else {
        videoElement.pause();
      }
    }

    // Funciones de control de video
    function rewind() {
      if (videoElement) {
        videoElement.currentTime = Math.max(0, videoElement.currentTime - 10);
      }
    }

    function forward() {
      if (videoElement) {
        videoElement.currentTime = Math.min(videoElement.duration, videoElement.currentTime + 10);
      }
    }

    // Función para alternar silencio
    function toggleMute() {
      if (!videoElement) return;

      videoElement.muted = !videoElement.muted;
      const volumeBtn = document.getElementById('volumeBtn');

      if (videoElement.muted) {
        volumeBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
      } else {
        volumeBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
      }
    }

    // Función para alternar subtítulos
    function toggleSubtitles() {
      if (!videoElement || !videoElement.textTracks) return;

      const textTracks = videoElement.textTracks;
      const subtitlesBtn = document.getElementById('subtitlesBtn');

      if (textTracks.length === 0) {
        showErrorMessage('No hay subtítulos disponibles para este contenido');
        return;
      }

      let activeTrack = null;
      for (let i = 0; i < textTracks.length; i++) {
        if (textTracks[i].mode === 'showing') {
          activeTrack = textTracks[i];
          break;
        }
      }

      if (activeTrack) {
        activeTrack.mode = 'disabled';
        subtitlesBtn.style.color = '#71767b';
        showErrorMessage('Subtítulos desactivados');
      } else {
        textTracks[0].mode = 'showing';
        subtitlesBtn.style.color = '#1d9bf0';
      }
    }

    // Función para alternar idioma de audio
    function toggleAudioLanguage() {
      if (!currentSeries || !currentSeries.audioTracks) {
        showErrorMessage('No hay pistas de audio alternativas disponibles');
        return;
      }

      const tracks = Object.keys(currentSeries.audioTracks);
      const currentIndex = tracks.indexOf(currentSeries.currentAudioTrack || 'original');
      const nextIndex = (currentIndex + 1) % tracks.length;
      const nextTrack = tracks[nextIndex];

      currentSeries.currentAudioTrack = nextTrack;
      videoElement.src = currentSeries.audioTracks[nextTrack];

      const currentTime = videoElement.currentTime;
      videoElement.load();
      videoElement.currentTime = currentTime;
      videoElement.play();

      showErrorMessage(`Audio: ${nextTrack}`);
    }

    // Función para configurar subtítulos
    function configureSubtitles() {
      if (!currentSeries || !currentSeries.subtitles) return;

      // Remover tracks existentes
      const existingTracks = videoElement.querySelectorAll('track');
      existingTracks.forEach(track => track.remove());

      // Agregar nuevos tracks
      Object.keys(currentSeries.subtitles).forEach(language => {
        const track = document.createElement('track');
        track.kind = 'captions';
        track.src = currentSeries.subtitles[language];
        track.srclang = language;
        track.label = language === 'spanish' ? 'Español' : 'English';

        if (language === 'spanish') {
          track.default = true;
        }

        videoElement.appendChild(track);
      });
    }

    // Función para actualizar duración
    function updateDuration() {
      if (!videoElement || !durationElement) return;

      const duration = videoElement.duration;
      if (!isNaN(duration)) {
        durationElement.textContent = formatTime(duration);
      }
    }

    // Función para actualizar duración en tiempo real
    function updateRealTimeDuration(episodeId) {
      if (!videoElement) return;

      videoElement.addEventListener('loadedmetadata', () => {
        const duration = videoElement.duration;
        if (!isNaN(duration)) {
          const durationEl = document.getElementById(`duration-${episodeId}`);
          if (durationEl) {
            durationEl.textContent = formatTime(duration);
          }
        }
      });
    }

    // Función para formatear tiempo
    function formatTime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = Math.floor(seconds % 60);

      if (hours > 0) {
        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      } else {
        return `${minutes}:${secs.toString().padStart(2, '0')}`;
      }
    }

    // Función para iniciar actualización de progreso
    function startProgressUpdate() {
      if (progressUpdateInterval) {
        clearInterval(progressUpdateInterval);
      }

      progressUpdateInterval = setInterval(() => {
        if (videoElement && !videoElement.paused) {
          const progress = (videoElement.currentTime / videoElement.duration) * 100;
          videoProgressFill.style.width = `${progress}%`;
          currentTimeElement.textContent = formatTime(videoElement.currentTime);
        }
      }, 1000);
    }

    // Función para mostrar/ocultar botón de play
    function showPlayButton() {
      // Implementar si es necesario
    }

    function hidePlayButton() {
      // Implementar si es necesario
    }

    // Función para habilitar pantalla completa y rotación
    function enableVideoFullscreenAndRotation() {
      // Forzar orientación landscape en móviles si es posible
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(() => {
          // Ignorar error si no se puede bloquear orientación
        });
      }
    }

    // Función para mostrar mensaje de error
    function showErrorMessage(message) {
      const errorEl = document.createElement('div');
      errorEl.style.cssText = `
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(239, 68, 68, 0.9);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        z-index: 5000;
        backdrop-filter: blur(12px);
      `;
      errorEl.textContent = message;

      document.body.appendChild(errorEl);

      setTimeout(() => {
        if (errorEl.parentNode) {
          errorEl.parentNode.removeChild(errorEl);
        }
      }, 3000);
    }

    // Función para mostrar mensaje de bloqueo
    function showLockedMessage(series) {
      showErrorMessage('Este contenido no está disponible aún. Revisa la fecha de estreno.');
    }

    // Función para mostrar mensaje de bloqueo de pantalla
    function showLockMessage(message) {
      showErrorMessage(message);
    }

    // Función para actualizar cuenta regresiva a junio
    function updateCountdownToJune() {
      // Esta función ya no es necesaria para NO TE MUEVAS
      // ya que está completamente desbloqueada
    }

    // Función para mostrar mensaje de estreno del 11 de junio
    function showJuneReleaseMessage(releaseDate) {
      const formattedDate = releaseDate.toLocaleDateString('es-ES', {
        weekday: 'long',
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });

      const formattedTime = '2:40 AM (Houston) | 12:40 AM (Las Vegas)';

      const message = `ESTRENO MUNDIAL: ${formattedDate} a las ${formattedTime}.\n\nUna transmisión única que no te puedes perder.`;
      showErrorMessage(message);
    }

    // Función para mostrar cuenta regresiva en los detalles
    function showCountdownInDetails(series) {
      // Remover cuenta regresiva existente
      const existingCountdown = document.getElementById('detailsCountdown');
      if (existingCountdown) {
        existingCountdown.remove();
      }

      // Solo mostrar para NO TE MUEVAS si está bloqueada
      if (series.id !== 'notemuevas') return;

      const hasBeenWatched = hasMovieBeenWatched('notemuevas');
      const isAvailable = isMovieAvailable(series);

      // No mostrar si ya fue vista o está disponible
      if (hasBeenWatched || isAvailable) return;

      // Crear elemento de cuenta regresiva
      const countdownEl = document.createElement('div');
      countdownEl.id = 'detailsCountdown';
      countdownEl.style.cssText = `
        background: linear-gradient(135deg, rgba(29, 155, 240, 0.1), rgba(13, 110, 253, 0.1));
        border: 2px solid rgba(29, 155, 240, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin: 20px 16px;
        text-align: center;
        backdrop-filter: blur(10px);
      `;

      // Insertar después de las acciones
      const seriesActions = document.querySelector('.series-actions');
      seriesActions.insertAdjacentElement('afterend', countdownEl);

      // Función para actualizar cuenta regresiva
      function updateDetailsCountdown() {
        const now = new Date();
        const releaseDate = createJuneReleaseDate();
        const timeDiff = releaseDate.getTime() - now.getTime();

        if (timeDiff <= 0) {
          // Estreno llegó, remover cuenta regresiva y actualizar botón
          countdownEl.remove();
          updatePlayButton(series);
          return;
        }

        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

        countdownEl.innerHTML = `
          <div style="color: #1d9bf0; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">
            🎬 ESTRENO MUNDIAL
          </div>
          <div style="display: flex; justify-content: center; gap: 12px; margin-bottom: 12px;">
            <div style="background: rgba(29, 155, 240, 0.2); border-radius: 8px; padding: 8px; min-width: 45px; border: 1px solid rgba(29, 155, 240, 0.3);">
              <div style="font-size: 18px; font-weight: 800; color: #ffffff;">${days}</div>
              <div style="font-size: 10px; color: #71767b; font-weight: 600;">DÍAS</div>
            </div>
            <div style="background: rgba(29, 155, 240, 0.2); border-radius: 8px; padding: 8px; min-width: 45px; border: 1px solid rgba(29, 155, 240, 0.3);">
              <div style="font-size: 18px; font-weight: 800; color: #ffffff;">${hours}</div>
              <div style="font-size: 10px; color: #71767b; font-weight: 600;">HRS</div>
            </div>
            <div style="background: rgba(29, 155, 240, 0.2); border-radius: 8px; padding: 8px; min-width: 45px; border: 1px solid rgba(29, 155, 240, 0.3);">
              <div style="font-size: 18px; font-weight: 800; color: #ffffff;">${minutes}</div>
              <div style="font-size: 10px; color: #71767b; font-weight: 600;">MIN</div>
            </div>
            <div style="background: rgba(29, 155, 240, 0.2); border-radius: 8px; padding: 8px; min-width: 45px; border: 1px solid rgba(29, 155, 240, 0.3);">
              <div style="font-size: 18px; font-weight: 800; color: #ffffff;">${seconds}</div>
              <div style="font-size: 10px; color: #71767b; font-weight: 600;">SEG</div>
            </div>
          </div>
          <div style="color: #71767b; font-size: 12px; font-weight: 600; margin-bottom: 8px;">
            11 de Junio - 2:40 AM Houston | 12:40 AM Las Vegas
          </div>
          <div style="color: #1d9bf0; font-size: 11px; font-weight: 600;">
            Transmisión simultánea mundial - Una sola vez
          </div>
        `;
      }

      // Actualizar cada segundo
      updateDetailsCountdown();
      const interval = setInterval(updateDetailsCountdown, 1000);

      // Limpiar intervalo cuando se cierre los detalles
      const originalClose = closeSeriesDetail;
      closeSeriesDetail = function() {
        clearInterval(interval);
        originalClose();
      };
    }

    // Función para cerrar detalles de serie
    function closeSeriesDetail() {
      document.getElementById('seriesDetail').classList.remove('active');

      // Limpiar video de trailer
      const videoEl = document.getElementById('seriesDetailVideo');
      if (videoEl) {
        videoEl.pause();
        videoEl.src = '';
        videoEl.classList.remove('loaded');
        videoEl.style.display = 'none';
      }

      // Resetear botones
      const playBtn = document.getElementById('netflixPlayBtn');
      const soundBtn = document.getElementById('soundToggle');
      if (playBtn) playBtn.classList.remove('loading');
      if (soundBtn) {
        soundBtn.style.display = 'none';
        soundBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
      }

      currentSeries = null;
    }

    // Función para cargar contenido (episodios o película)
    function loadContent(series) {
      const episodesList = document.getElementById('episodesList');
      const episodesTitle = document.querySelector('.episodes-title');

      // Cambiar título según el tipo
      if (series.type === 'movie' || series.type === 'shortfilm') { // Considerar cortometraje
        episodesTitle.textContent = series.type === 'movie' ? 'Película' : 'Cortometraje';
      } else {
        episodesTitle.textContent = 'Episodios - Temporada 1';
      }

      episodesList.innerHTML = '';

      series.episodes.forEach(episode => {
        const episodeElement = document.createElement('div');
        episodeElement.className = 'episode-item';
        episodeElement.onclick = () => playEpisode(1, episode.id);

        // Para películas y cortometrajes, no mostrar número de episodio
        const episodeNumber = (series.type === 'movie' || series.type === 'shortfilm') ? '' : `${episode.id}. `;
        const durationDisplay = episode.duration || 'Cargando...';

        episodeElement.innerHTML = `
          <div class="episode-thumbnail">
            <img src="${episode.thumbnail}" alt="${episode.title}">
            <div class="episode-play-overlay">
              <i class="fas fa-play"></i>
            </div>
          </div>
          <div class="episode-info">
            <div class="episode-header">
              <span class="episode-number">${episodeNumber}${episode.title}</span>
              <span class="episode-duration" id="duration-${episode.id}">${durationDisplay}</span>
            </div>
            <div class="episode-description">${episode.description}</div>
          </div>
        `;

        episodesList.appendChild(episodeElement);
      });
    }

    // Función para reproducir intro de IBTV
    function playIBTVIntro(callback) {
      isPlayingIntro = true;

      // Limpiar video anterior
      videoElement.removeAttribute('src');
      videoElement.load();

      // Configurar video para máxima compatibilidad móvil
      videoElement.setAttribute('playsinline', 'true');
      videoElement.setAttribute('webkit-playsinline', 'true');
      videoElement.setAttribute('x5-playsinline', 'true');
      videoElement.setAttribute('x5-video-player-type', 'h5');
      videoElement.controls = false;
      videoElement.preload = 'metadata';
      videoElement.crossOrigin = 'anonymous';

      // Configurar título para el intro
      videoPlayerTitle.textContent = 'IBTV';

      // Ocultar indicador EN VIVO durante el intro
      const liveIndicator = document.getElementById('videoLiveIndicator');
      liveIndicator.style.display = 'none';

      // Agregar clase al body para controlar overflow
      document.body.classList.add('video-playing');

      // Mostrar reproductor
      videoPlayer.classList.add('active');

      // Configurar fuente del intro
      videoElement.src = introVideoUrl;

      // Event listeners del intro
      const onIntroLoadedMetadata = () => {
        updateDuration();
        // Auto-reproducir el intro sin botón de play
        videoElement.play().catch(e => {
          console.warn('Autoplay blocked, showing play button for intro');
          showPlayButton();
        });
      };

      const onIntroPlay = () => {
        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
        pauseIndicator.classList.remove('visible');
        hidePlayButton();
      };

      const onIntroPause = () => {
        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        pauseIndicator.classList.add('visible');
      };

      const onIntroEnded = () => {
        // Cuando termina el intro, reproducir el contenido principal
        isPlayingIntro = false;

        // Limpiar listeners del intro
        videoElement.removeEventListener('loadedmetadata', onIntroLoadedMetadata);
        videoElement.removeEventListener('play', onIntroPlay);
        videoElement.removeEventListener('pause', onIntroPause);
        videoElement.removeEventListener('ended', onIntroEnded);
        videoElement.removeEventListener('error', onIntroError);

        // Ejecutar callback para reproducir contenido principal
        if (callback) {
          callback();
        }
      };

      const onIntroError = (e) => {
        console.error('Intro error:', e);
        isPlayingIntro = false;

        // Si hay error en el intro, ir directo al contenido
        videoElement.removeEventListener('loadedmetadata', onIntroLoadedMetadata);
        videoElement.removeEventListener('play', onIntroPlay);
        videoElement.removeEventListener('pause', onIntroPause);
        videoElement.removeEventListener('ended', onIntroEnded);
        videoElement.removeEventListener('error', onIntroError);

        if (callback) {
          callback();
        }
      };

      // Agregar listeners del intro
      videoElement.addEventListener('loadedmetadata', onIntroLoadedMetadata);
      videoElement.addEventListener('play', onIntroPlay);
      videoElement.addEventListener('pause', onIntroPause);
      videoElement.addEventListener('ended', onIntroEnded);
      videoElement.addEventListener('error', onIntroError);

      // Iniciar actualización de progreso
      startProgressUpdate();
    }

    // Función para reproducir contenido principal después del intro
    function playMainContent(episode) {
      // Habilitar pantalla completa automática y rotación
      enableVideoFullscreenAndRotation();

      // Limpiar video anterior
      videoElement.removeAttribute('src');
      videoElement.load();

      // Configurar video para máxima compatibilidad móvil
      videoElement.setAttribute('playsinline', 'true');
      videoElement.setAttribute('webkit-playsinline', 'true');
      videoElement.setAttribute('x5-playsinline', 'true');
      videoElement.setAttribute('x5-video-player-type', 'h5');
      videoElement.setAttribute('x5-video-player-fullscreen', 'true');
      videoElement.controls = false;
      videoElement.preload = 'metadata';
      videoElement.crossOrigin = 'anonymous';

      // Título diferente para películas vs series
      if (currentSeries.type === 'movie' || currentSeries.type === 'shortfilm') {
        videoPlayerTitle.textContent = currentSeries.title;
      } else {
        videoPlayerTitle.textContent = `${currentSeries.title} - ${episode.title}`;
      }

      // Ocultar indicador EN VIVO para películas normales
      const liveIndicator = document.getElementById('videoLiveIndicator');
      liveIndicator.style.display = 'none';

      // Configurar subtítulos si están disponibles
      configureSubtitles();

      // Configurar fuente de video con mejor compatibilidad
      const source = document.createElement('source');
      source.src = episode.videoUrl;
      source.type = 'video/mp4'; // Asumir mp4 por defecto
      videoElement.appendChild(source);

      // Event listeners del contenido principal
      const onLoadedMetadata = () => {
        updateDuration();
        updateRealTimeDuration(episode.id);
        // Auto-reproducir después del intro
        videoElement.play().catch(e => {
          console.warn('Autoplay blocked after intro');
          showPlayButton();
        });
      };

      const onPlay = () => {
        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
        pauseIndicator.classList.remove('visible');
        hidePlayButton();
      };

      const onPause = () => {
        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        pauseIndicator.classList.add('visible');
      };

      const onError = (e) => {
        console.error('Video error:', e);
        showErrorMessage('Error al cargar el video. Verifica tu conexión e intenta de nuevo.');
      };

      // Remover listeners anteriores
      videoElement.removeEventListener('loadedmetadata', onLoadedMetadata);
      videoElement.removeEventListener('play', onPlay);
      videoElement.removeEventListener('pause', onPause);
      videoElement.removeEventListener('error', onError);

      // Agregar nuevos listeners
      videoElement.addEventListener('loadedmetadata', onLoadedMetadata);
      videoElement.addEventListener('play', onPlay);
      videoElement.addEventListener('pause', onPause);
      videoElement.addEventListener('error', onError);

      // Iniciar actualización de progreso
      startProgressUpdate();
    }

    // Función para reproducir episodio (modificada para incluir intro)
    function playEpisode(season, episodeId) {
      if (!currentSeries) return;

      // Verificar si la película está disponible para reproducción
      if (currentSeries.isLocked && !isMovieAvailable(currentSeries)) {
        showLockedMessage(currentSeries);
        return;
      }

      const episode = currentSeries.episodes.find(ep => ep.id === episodeId);
      if (!episode) return;

      currentVideo = episode;

      // Reproducir intro de IBTV primero, luego el contenido principal
      playIBTVIntro(() => {
        playMainContent(episode);
      });
    }

    // Función para reproducir trailer
    function playTrailer() {
      if (!currentSeries || !currentSeries.trailer) {
        showErrorMessage('Trailer no disponible');
        return;
      }

      // Crear objeto de trailer para reproducir
      const trailerVideo = {
        id: 'trailer',
        title: 'Trailer Oficial',
        description: 'Trailer oficial',
        duration: '2:30',
        thumbnail: currentSeries.poster,
        videoUrl: currentSeries.trailer
      };

      currentVideo = trailerVideo;

      // Reproducir intro de IBTV primero, luego el trailer
      playIBTVIntro(() => {
        playTrailerContent(trailerVideo);
      });
    }


      // Función para reproducir contenido de trailer después del intro
      function playTrailerContent(trailerVideo) {
        // Limpiar video anterior
        videoElement.removeAttribute('src');
        videoElement.load();

        // Configurar video para máxima compatibilidad móvil
        videoElement.setAttribute('playsinline', 'true');
        videoElement.setAttribute('webkit-playsinline', 'true');
        videoElement.setAttribute('x5-playsinline', 'true');
        videoElement.setAttribute('x5-video-player-type', 'h5');
        videoElement.controls = false;
        videoElement.preload = 'metadata';
        videoElement.crossOrigin = 'anonymous';

        videoPlayerTitle.textContent = `${currentSeries.title} - ${trailerVideo.title}`;

        // Ocultar indicador EN VIVO para trailers
        const liveIndicator = document.getElementById('videoLiveIndicator');
        liveIndicator.style.display = 'none';

        // Configurar fuente
        videoElement.src = trailerVideo.videoUrl;

        // Event listeners para trailer
        const onLoadedMetadata = () => {
            updateDuration();
            // Auto-reproducir después del intro
            const playPromise = videoElement.play();
            if (playPromise !== undefined) {
              playPromise.then(() => {
                console.log('Trailer playing automatically');
              }).catch(e => {
                console.log('Autoplay prevented:', e);
                showPlayButton();
              });
            }
        };

        const onPlay = () => {
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            pauseIndicator.classList.remove('visible');
            hidePlayButton();
        };

        const onPause = () => {
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            pauseIndicator.classList.add('visible');
        };

        const onError = (e) => {
            console.error('Trailer error:', e);
            showErrorMessage('Error al cargar el trailer');
        };

        videoElement.addEventListener('loadedmetadata', onLoadedMetadata);
        videoElement.addEventListener('play', onPlay);
        videoElement.addEventListener('pause', onPause);
        videoElement.addEventListener('error', onError);

        startProgressUpdate();
      }

      // Función de descarga de contenido actual
      function downloadCurrentContent() {
        if (!currentVideo || !currentVideo.videoUrl) {
          showErrorMessage("No se puede descargar contenido en este momento.");
          return;
        }

        const url = currentVideo.videoUrl;
        const filename = currentVideo.title || "downloaded_content";

        // Intentar descargar el archivo
        const link = document.createElement('a');
        link.href = url;
        link.download = filename; // Nombre del archivo para descargar

        // Simular clic en el enlace
        document.body.appendChild(link);
        link.click();

        // Remover el enlace después de la descarga
        document.body.removeChild(link);

        // Mostrar mensaje de que la descarga ha comenzado
        showDownloadMessage(`Iniciando descarga de "${filename}"...`);
      }

      // Mostrar mensaje de inicio de descarga
      function showDownloadMessage(message) {
        const messageEl = document.createElement('div');
        messageEl.style.cssText = `
          position: fixed;
          bottom: 100px; /* Posicionar sobre la barra de navegación */
          left: 50%;
          transform: translateX(-50%);
          background: rgba(29, 155, 240, 0.9);
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 600;
          z-index: 5000;
          backdrop-filter: blur(12px);
          animation: slideInRight 3s ease-out forwards; /* Usar animación para que desaparezca */
        `;
        messageEl.innerHTML = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <i class="fas fa-download"></i>
            <span>${message}</span>
          </div>
        `;

        document.body.appendChild(messageEl);

        // Remover mensaje después de la animación
        setTimeout(() => {
          if (messageEl.parentNode) {
            messageEl.parentNode.removeChild(messageEl);
          }
        }, 3000);
      }

      // Función para crear y añadir el elemento para la sección de descargas en ajustes
      function addDownloadSectionToSettings() {
        const settingsContent = document.querySelector('.settings-content');
        if (!settingsContent) return;

        // Verificar si la sección de descargas ya existe
        if (document.getElementById('downloadSettingsGroup')) return;

        const downloadGroup = document.createElement('div');
        downloadGroup.className = 'settings-group';
        downloadGroup.id = 'downloadSettingsGroup';
        downloadGroup.innerHTML = `
          <h3 class="settings-group-title">
            <i class="fas fa-download"></i>
            Descargas
          </h3>
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-name">Espacio de Almacenamiento</div>
              <div class="setting-description">Libre: 50 GB / Total: 256 GB</div>
            </div>
            <div class="setting-select" style="background: #202327; border: 1px solid #333639; color: #ffffff; padding: 8px 12px; border-radius: 6px; font-size: 14px;">Ver Descargas</div>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-name">Descargas Automáticas</div>
              <div class="setting-description">Descargar automáticamente contenido seleccionado</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="autoDownloadToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <div class="setting-name">Calidad de Descarga</div>
              <div class="setting-description">Seleccionar calidad para descargas</div>
            </div>
            <select class="setting-select" id="downloadQuality">
              <option value="auto">Automática</option>
              <option value="1080p">1080p HD</option>
              <option value="720p">720p HD</option>
              <option value="480p">480p</option>
            </select>
          </div>
        `;

        // Añadir el nuevo grupo al final del contenido de ajustes
        settingsContent.appendChild(downloadGroup);

        // Actualizar configuraciones de descargas si existen
        loadDownloadSettings();
      }

      // Cargar configuraciones dedescarga
    function loadDownloadSettings() {
      const settings = JSON.parse(localStorage.getItem('ibtv_download_settings') || '{}');

      document.getElementById('autoDownloadToggle').checked = settings.autoDownload !== false;
      document.getElementById('downloadQuality').value = settings.downloadQuality || 'auto';
    }

    // Guardar configuraciones de descarga
    function saveDownloadSettings() {
      const settings = {
        autoDownload: document.getElementById('autoDownloadToggle').checked,
        downloadQuality: document.getElementById('downloadQuality').value
      };
      localStorage.setItem('ibtv_download_settings', JSON.stringify(settings));
      showSettingsMessage('Configuración de descarga guardada');
    }

    // Inicializar la sección de descargas al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
      addDownloadSectionToSettings();
      // ... resto de la inicialización ...
    });

    // Modificación para la función de bloqueo de pantalla
    // Reemplazar en la función lockScreen()
    function lockScreen() {
      if (!videoPlayer.classList.contains('active')) return;

      isScreenLocked = true;
      document.getElementById('screenLockOverlay').classList.add('active');

      // Ocultar controles del video
      const header = document.querySelector('.video-player-header');
      const controls = document.querySelector('.video-player-controls');
      if (header && controls) {
        // Ocultar controles para siempre hasta desbloquear
        header.style.display = 'none';
        controls.style.display = 'none';
      }
      // Ocultar el botón de bloqueo también, para evitar clics accidentales
      const lockButton = document.querySelector('.screen-lock-btn');
      if(lockButton) lockButton.style.display = 'none';

      // Mostrar mensaje
      showLockMessage('Pantalla bloqueada - Toca el botón para desbloquear');
    }

    // Modificación para la función de desbloqueo de pantalla
    // Reemplazar en la función unlockScreen()
    function unlockScreen() {
      isScreenLocked = false;
      document.getElementById('screenLockOverlay').classList.remove('active');

      // Mostrar controles del video
      const header = document.querySelector('.video-player-header');
      const controls = document.querySelector('.video-player-controls');
      if (header && controls) {
        header.style.display = 'flex'; // Asegurarse de que sean visibles
        controls.style.display = 'block'; // Asegurarse de que sean visibles
      }
      // Mostrar el botón de bloqueo nuevamente
      const lockButton = document.querySelector('.screen-lock-btn');
      if(lockButton) lockButton.style.display = 'flex';

      // Mostrar mensaje
      showLockMessage('Pantalla desbloqueada');
    }

  </script>
</body>
</html>